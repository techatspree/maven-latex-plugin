\RequirePackage[l2tabu, orthodox]{nag}
% blabla 
%\PassOptionsToPackage{dvipdfmx}{xcolor} %or dvipdfm 
%\PassOptionsToPackage{dvipdfmx}{graphicx} %or dvipdfm 
%\RequirePackage{lmodern} % does not work with htlatex
\documentclass[12pt]{book}
\synctex=1
\newif\iflatextortf % false for latex but set true for latex2rtf internally 
\pdfminorversion=7

\input{header.tex}

% TBD: integrate that into git 
\newcommand{\groupId}{\texttt{eu.simuline.m2latex}}
\newcommand{\artifactId}{\texttt{latex-maven-plugin}}
\newcommand{\versionID}{\texttt{1.5-SNAPSHOT}}
\newcommand{\repo}{\texttt{ftp://www.simuline.eu/public\_html/RepositoryMaven}}
\newcommand{\devSite}{\texttt{https://github.com/Reissner/maven-latex-plugin}}

\ifthenelse{\boolean{texFhtLoaded}}{%
  % no glossaries and no index with tex4ht 
  \newcommand{\gls}[1]{#1}
  \renewcommand{\index}[1]{ }
}{%
\setacronymstyle{long-short}
% file formats 
\newacronym{pdf}{pdf}{portable document format}
\newacronym{dvi}{dvi}{device independent file format}
\newacronym{eps}{eps}{encapsulated postscript}
\newacronym{tex}{tex}{tex the format, which may also be latex}
\newacronym{html}{html}{hypertext markup language}
\newacronym{xhtml}{xhtml}{extensible hypertext markup language}
\newacronym{odt}{odt}{open document text}
\newacronym{doc}{doc}{outdated document format for MS word }
\newacronym{docx}{docx}{current document format for MS word }
\newacronym{sgml}{sgml}{Standard generalized markup language }
\newacronym{xml}{xml}{extensible markup language }
\newacronym{ptx}{ptx}{pdf/postscript tex format }% home brewed 

\newacronym{fig}{fig}{native file format for xfig }
\newacronym{gp}{gp}{Gnuplot file format}
\newacronym{png}{png}{Portable Network Graphics}
\newacronym{jpg}{jpg}{Graphics format developed by the Joint Photographic Experts Group }
\newacronym{gif}{gif}{Graphics Interchange Format, allows also animations }
\newacronym{svg}{svg}{Scalable Vector Graphics}
% latex file endings 
\newacronym{toc}{toc}{table of contents}
\newacronym{lof}{lof}{list of figures}
\newacronym{lot}{lot}{list of tables}
\newacronym{lol}{lol}{list of listings}
\newacronym{aux}{aux}{auxiliary file}
\newacronym{log}{log}{logging file (for \LaTeX{} and mpost)}
\newacronym{idx}{idx}{index file containing unsorted and multiple index entries}
\newacronym{ind}{ind}{%
index file containing sorted, unified and formatted index entries}
\newacronym{glo}{glo}{%
glossary file containing unsorted and multiple glossary entries}
\newacronym{gls}{gls}{%
glossary file containing sorted, unified and formatted glossary entries}


\newacronym{mp}{mp}{metapost}
\newacronym{ps}{ps}{PostScript}
\newacronym{mps}{mps}{metapost's postscript like output including text}
\newacronym{mpx}{mpx}{metapost tex output: texts }
}

% \newglossaryentry{latex}{name={latex},description={%
% A document preparation system 
% converting sources in the latex-format preferrably into pdf-output. 
% Historically, output was in \gls{dvi}-format 
% which is still used by htlatex as an intermediate format 
% to produce \gls{html} resp.~\gls{xhtml} and \gls{odt} output. 
% }}
% \newglossaryentry{htlatex}{name={htlatex},description={%
% A script which wraps latex 
% but producing (x)html and odt output instead of pdf 
% which is usual for latex. 
% }}
%\newglossaryentry{ps}{name={PostScript},description={%
%A computer language for creating vector graphics. 
%}}


% how to number the glossary in the toc? seemingly a gap in tocbibind 
\usepackage[nottoc, numindex, numbib]{tocbibind}

\renewcommand{\lstlistoflistings}{\begingroup
\tocfile{\lstlistingname}{lol}
\endgroup}
%and to number the Listof heading do:
\renewcommand{\lstlistoflistings}{\begingroup
%\tocsection
%\tocchapter
\tocfile{List of \lstlistingname{}s}{lol}
\endgroup}


\newindex[General Index]{idx}
\newindex[LaTeX Packages]{pkg}
% does not work 
%\setindexpreamble[pkg]{This index comprises all the latex packages used. }

\title{Manual for the \artifactId{} and for an according ant-task }
\author{Ernst Reissner (rei3ner@arcor.de)}


\begin{document}
\maketitle

\tableofcontents
\listoffigures
\listoftables
\lstlistoflistings


\chapter{Introduction}

This document is created with \texttt{pdflatex} or that like 
with output format 
\ifpdf%
pdf%
\else
dvi%
\fi.
The package \pkg{tex4ht} 
is \ifthenelse{\boolean{texFhtLoaded}}{}{not} loaded. 

\LaTeX{} is a beautiful way to create printable documents, 
in our days preferably as \gls{pdf}-files, 
with a particular strength in typesetting formulae like
% pandoc invocation given in README.md
% TBD: check why pandoc can create this formula whereas it fails for align.
% TBD: pandoc seems to have problems with links to tables
% and tables dont look optimal.
% TBD: link to figures seem not to work, to be honest i cannot see any figure
% whereas toc is present, other tables are not.
% also index, bibliography and that like seems to miss. 
%
% \begin{equation*}
%   \pi  = \sqrt{12}\;\sum^\infty_{k=0} \frac{(-3)^{-k}}{2k+1}. %chktex 3
% \end{equation*}
%
\begin{align}
\pi & = \sqrt{12}\;\sum^\infty_{k=0} \frac{(-3)^{-k}}{2k+1}. %chktex 3
\end{align}
%
Here, portability of the format \gls{pdf} is a vital feature. 
In the past, normally \gls{dvi} (device independent)
described in~\cite{DviF} has been used 
and still creation of external formats like \gls{html}, 
\gls{odt} and \gls{docx} are based on an intermediate \gls{dvi}-file.
It is much more lightweight than pdf specified in~\cite{Pdf1}, \cite{Pdf2}
and in~\cite{Pdf3}.
% strange: no mention of other formats
% epub for example, htm, xhtml and office formats also rtf
% manpages, javahelp

This piece of software implements both an ant-task and a maven-plugin 
generating documentation of various formats from \LaTeX-files 
in an uniform way. 
Chapter~\ref{chap:install} shows how to install both the maven-plugin 
and the ant-task 
and Chapter~\ref{chap:usage} describes the usage. 
Note that the maven-plugin is both easier to install 
and more versatile to be used. 

From the \LaTeX-files, the latex main files must be extracted, 
only these must be compiled. 
It is very usual to endow \LaTeX-files with figures. 
On the other hand, there are many graphic formats 
which cannot be included directly in a \LaTeX-file 
but must be preprocessed. 
If there is some format needed but not yet provided, 
please write an email to the author. 

Graphic files must be preprocessed before processing latex main files, 
as described in Chapter~\ref{chap:GraphConversions}. 
Then follows the proper processing of latex main files 
including creation of index and glossaries 
as described in Chapter~\ref{chap:latexMainConversions}. 
Besides \gls{pdf}, these formats include the web-formats \gls{html} 
and \gls{xhtml}, 
open offices format \gls{odt}, Microsoft's word formats like \gls{docx} 
and finally plain text. 

Uniformity of ant-task and a maven-plugin means in particular, 
that the settings which may be passed to the task 
and those allowed for the plugin are in a one-to-one relation. 
They are both described in Chapter~\ref{chap:settings}. 
It is a design goal, that the auxiliary programs 
used by this software are fully configurable via parameters, 
that aspects not completely specified can be handled flexibly, 
there are parameters supporting information development 
and that for the parameters are default values 
which allow to do without explicit parametrization in most of the cases. 
\index{ant-task}
Both, the ant-task and the maven-plugin rely on the same code base 
which form the package \texttt{org.m2latex.core}. 
The code specific for the ant-task is in \texttt{org.m2latex.antTask} 
and that specific for the maven-plugin is in \texttt{org.m2latex.mojo}. 


The creation process supports an index, a glossary and a bibliography. 
Again, further functionality can be added by demand. 

The present manual is created by the maven-plugin or the ant-task 
described here. 
There should be no difference in the result. 
This manual is designed in a way that it covers the most important features 
but also to demand the most important features. 
That way, creating this manual is a top level test 
for the underlying software. 
The maven-plugin is somehow superior 
because it better supports the design process for the \LaTeX{} sources. 

If something goes wrong in the build process, 
or there is an indication 
of some deficiency in the result of the build process, 
processing must be aborted if going on does not make sense 
and there must be some error or warning logging 
as described in Chapter~\ref{chap:exceptionLogging}. 

The configuration of the maven plugin and of the ant-task 
are given in Chapter~\ref{chap:listings}
in Listing~\ref{lst:fullConfig} and in Listing~\ref{lst:fullConfig},
respectively. 

The author found some gaps, i.e.~desirable features 
which are not yet implemented. 
To prioritize further work, 
all these gaps are collected in Chapter~\ref{chap:gaps}. 
Accordingly, the most important bugs are collected in
Chapter~\ref{chap:bugs}. 
The user is encouraged to contribute with feature requests 
and bug reports and to vote for realization of features 
and on fixing bugs. 
Software quality is ensured mainly through tests 
which are described in Chapter~\ref{chap:tests}. 


\chapter{Installation}\label{chap:install}

Both the ant-task and the maven-plugin just direct parameters 
from ant and from maven, respectively, 
to the programs that do the proper work. 
Thus installation of the ant-task and of the maven-plugin 
requires that all needed programs are installed. 
These prerequisites are collected in Section~\ref{sec:prerequisites}. 
\index{ant-task}

\section{Prerequisites}\label{sec:prerequisites}

The ant-task is tested with \index{ant}
%
\begin{verbatim}
Apache Ant(TM) version 1.9.4 compiled on September 11 2015}
\end{verbatim}
%
and the maven-plugin with 
%
\index{maven}
\begin{verbatim}
Apache Maven 3.3.9 \
(bb52d8502b132ec0a5a3f4c09453c07478323dc5; 
2015-11-10T17:41:47+01:00)
\end{verbatim}
%
Both, ant and maven are written in java and require a java installation. 
The java\index{java} version used for tests 
is \texttt{1.8.0\_101, vendor: Oracle Corporation}. 


So, a java installation is the base for running either the ant-task 
or the maven-plugin. 
Also this plugin is written in java. 
To use the maven-plugin, of course maven must be installed 
and to use the ant-task, ant must be installed. 

The ant-task just passes parameters in the build file to the core 
and accordingly the maven-plugin passes parameters in the pom 
to the core of this software. 
The core just invokes various programs to do the actual work. 
\index{ant-task}

Besides plain building of documentation, 
this software also supports documentation development. 
\LaTeX{} and related programs are based on text files mainly 
and so a good editor is required for development. 
The author recommends and uses good old 
\texttt{GNU Emacs 24.3.1 (x86\_64-suse-linux-gnu, GTK+ Version 3.16.7)} 
together with several packages to support 
various file formats. 
To list the available packages type 
\texttt{M-x list-packages}. 
For comfortable development with \LaTeX, 
the \texttt{auctex} package, version \texttt{11.88} is recommended. 
The version is displayed from within Emacs 
by typing \texttt{C-h v AUCTeX-version RET}. 
For an overview on \texttt{auctex} see~\cite{AucTeX}. 


FIXME\@: gnuplot-mode expects file extension gp. 
Should be made configurable. 

To edit metapost, the mode built-in mode \texttt{Metamode} is used. 

Built-in mode \texttt{Docview} to view pdf, ps and dvi. 

latexmk

Builtin modes bib-mode and bibtex

Built in reftex-modes

Useful: 
ac-math, auto-complete-auctex

Depending on what kinds of graphic formats are used, 
the following programs are required: 
%
\begin{itemize}
\item
To convert the \gls{fig}-files into \gls{pdf}-files, 
by default \texttt{fig2dev}\index{fig2dev} is used. 
It makes sense to have \texttt{xfig}\index{xfig} installed 
to create and edit fig-files, but this is not mandatory. 
\item
To convert gnuplot files into pdf-files, there is no alternative, 
to have installed \texttt{gnuplot}\index{gnuplot}. 
It serves as an interpreter and also as a converter. 
Strictly speaking, only the latter functionality is required here. 
\item
To convert \gls{mp}-files into \gls{eps}-files, 
\index{mpost}\index{metapost}
the interpreter \texttt{mpost} or equivalent is required. 
This comes with a standard tex-installation. 
With the standard configuration, 
the resulting eps-file can be viewed with \texttt{ghostscript} 
and for developing it is recommended to have \texttt{ghostscript} installed. 
\item
To include \gls{svg}-files into \LaTeX\index{svg}, 
\texttt{inkscape}\index{inkscape} must be installed. 
It also serves to create and to edit svg-files. 
\end{itemize}



Currently for including pdf-files in both cases, 
the driver \texttt{dvipdfmx} must be installed. 
Strictly speaking, this is required only for html-creation and related. 
Note that if no pictures created by \texttt{fig2dev}, \texttt{gnuplot}, 
\texttt{mpost} or by \texttt{inkscape} are used, of course, 
neither \texttt{fig2dev} nor \texttt{gnuplot},
\texttt{mpost}, \texttt{inkscape} 
nor \texttt{dvipdfmx} is needed. 
To include graphics, the graphics bundle described in~\cite{GraX} is required, 
except for svg-files which requires the svg-package 
described in~\cite{SvgP}. 

As the set of required software depends on the graphic formats 
which shall be imported, 
it depends also on the set of output-formats 
to be supported: 
%
\begin{itemize}
\item
To create pdf-files from \LaTeX-files we use \texttt{pdflatex} 
or some other kind of \LaTeX{} creating pdf-files 
like \texttt{xelatex} or \texttt{lualatex}. 
\index{pdflatex}\index{xelatex}\index{lualatex} 
\LaTeX{} uses several auxiliary programs. 
Above all \texttt{bibtex} to create the bibliography 
and \texttt{makeindex} and \texttt{splitindex} for the index 
and \texttt{makeglossaries} for the glossary. 
\index{bibtex}\index{makeindex}\index{splitindex}\index{makeglossaries}
The latter two 
also require the latex packages \pkg{makeidx}, optionally \pkg{showidx}, 
both described in~\cite{MkidxShIdxP}, 
the package \pkg{splitidx} documented in~\cite{SplitidxP}
and \pkg{glossaries} specified in~\cite{GloP}. 
Note that \texttt{makeglossaries} either invokes \texttt{makeindex} 
or \texttt{xindy}, depending on the parametrization of \pkg{glossaries}. 
Both, \texttt{makeglossaries} and \texttt{xindy} are written in Perl, 
which shall also be installed if a glossary is required. 

The package \pkg{rerunfilecheck} is in any standard \LaTeX-installation. 
It is almost mandatory 
because this software presupposes that package is present  
to ensure that the table of contents, list of figures, list of tables, 
the index and the glossary are up to date. 

It is standard to endow a pdf-file with hyperlinks. 
To support this, the package \pkg{hyperref} is required. 

****
\item
To create \gls{html}-files, 
or to be more precise any kind of \gls{sgml} and \gls{xml}, 
from \LaTeX-files, \texttt{htlatex} or alternatively \texttt{htxelatex} is used. 
Currently the author is not aware of any alternative to the two. 
This includes also creating open office documents like odt-files. 
Thus open office documents are created in two steps, 
the first is to create pdf-files with the according tools, 
the second one is done by \texttt{htlatex} or that like. 
\index{htlatex}\index{htxelatex}
\item
To create rtf-files, currently \texttt{latex2rtf} is used. 
Note that this does not require \texttt{pdflatex}. 
As a drawback, not all \LaTeX-packages are supported. 
\index{latex2rtf}
\item
MS word documents are created from open office documents 
via the command \texttt{odt2doc} and thus require three steps 
and so the according tool chain. 
\index{odt2doc} 
\item
Finally, there is a way, to create plain text files from the pdf-files 
via \texttt{pdftotext}. 
The way from \LaTeX{} to text via pdf makes sense 
because that text is well formatted math mode symbols like $\pi$. 
and because table of contents, index, glossary and that like are included. 
So, for that task, besides \texttt{pdftotext} the whole toolchain to create
pdf-files is required. 
\index{pdftotext}
\item
An application which does not create a target, 
i.e. a file in the target directory is \texttt{chktex} 
which just checks the latex main files and associated files. 
\end{itemize}

So to run this software, the aforementioned programs 
or at least the subset used, must be installed.
To obtain reproducible results, the versions must fit.
This version is checked with the executables with versions given by
Listing~\ref{lst:versionsExec} in Chapter~\ref{chap:listings}.


There are also several \LaTeX-packages needed or at least recommended. 
The recommended ones are 
%
\begin{itemize}
\item
\pkg{geometry} described in \cite{GeomP} 
to control page layout. 
\item
\pkg{microtype} described in \cite{MicroTyP} improve readability 
and make the document look nicer. 
It also helps to avoid bad boxes. 
\item
\pkg{hyperref} described in \cite{HyperTextP} 
to insert hypertext marks, which i do not want to miss in larger documents. 
% FIXME: with latex2rtf: 
%\newif\iflatextortf% false for latex but set true for latex2rtf internally 
%\iflatextortf\else\usepackage{hyperref}\fi % includes hyperrefss if not rtf
%\iflatextortf\else\begin{appendix}\fi
%\iflatextortf\else\end{appendix}\fi
\item
\pkg{srcltx} described in \cite{SrcLtxP} 
which allows to jump from the DVI file to the .tex source and back.
% TBD: indicate as deprecated. 
\item
\pkg{showframe} 
if \pkg{geometry} is not used with option \pkg{showframe}. 
There seems to be no package documentation for package \pkg{showframe}. 
\item
\pkg{booktabs} described in \cite{BooktP} 

\item
\pkg{fix-cm} described in \cite{FixCmP} and 
\pkg{anyfontsize} described in \cite{AnyfontsizeP} 
to allow arbitrary font sizes, eliminating certain warnings. 
\end{itemize}

\noindent
Almost required are 
%
\begin{itemize}
\item
\pkg{rerunfilecheck} described in \cite{RerunFChkP} 
which writes additional rerun warnings to the log file 
if some auxiliary files have changed. 
This software relies on these warnings 
to control rerun latex and other applications. 
\item
\pkg{ifthen} described in \cite{IfThenP} 
which provides the \texttt{ifthenelse}-command 
which is needed to create both pdf and html and also to create rtf. 
\item
\pkg{ifpdf} described in \cite{IfPdfP} 
which provides the \cmd{ifpdf}-command to detect pdf-mode. 
This is required to distinguish creation of pdf and text 
from html, odt, doc and others, based on dvi. 
\item
The graphics packages described in \cite{GraX}, 
in particular \pkg{graphicx}, \pkg{xcolor} and \pkg{transparent}, 
the latter two described in \cite{XColorP} and in \cite{TransP}, 
respectively. 
Sometimes also \pkg{bmpsize} described in \cite{BmpP} 
if pixel graphics is used. 
\item
\pkg{import} described in \cite{ImpoP} 
e.g.~to import nested graphic files from arbitrary directories. 
\item
\texttt{inputenc} described in \cite{InputencP} 
to select an input encoding 
\texttt{fontenc} to select a font encoding. 
\cite{FontSel} describes font selection in general, 
with Section 5 on font encoding and 
Section 5.1 on the \texttt{fontenc} package. 
This package is almost indispensable if you do not write English, 
e.g.~to access German umlauts. 
Note that \cite{FontEnc} describes font encoding in more detail. 
\item 
\pkg{makeidx} and \pkg{showidx} described in \cite{MkidxShIdxP} 
or something comparable for creating indices. 
\item 
\pkg{glossaries} described in \cite{GloP} 
with tutorial \cite{GloPGuide}
or something comparable for creating glossaries. 
\item 
\pkg{tocbibind} described in \cite{TocBibIndP} 
to include bibliography and index (what about glossaries?) 
into the table of contents. 
\item 
\pkg{nag} described in \cite{NagP} 
which performs certain checks unveiling deficiencies 
not filtered by the compiler nor by another check tool. 
\item 
\pkg{babel} described in \cite{BabelP} for language support. 
This is not used by this manual, because it is in English. 
\end{itemize}

\noindent
Useful packages with which this software is tested: 
%
\begin{itemize}
\item
The ams-packages **** \pkg{amsmath}
\item
\pkg{longtable} described in \cite{LongTabP} 
for long tables, i.e.~tables exceeding a page. 
\item
\pkg{listings} described in \cite{ListingsP} for listings. 
\item
\pkg{fancyvrb} described in \cite{FancyVerbP} 
provides useful environments to mark verbatim text. 
\item
\pkg{ifxetex} described in \cite{IfXeTeXP} and 
\pkg{ifluatex} described in \cite{IfLuaTeXP} 
are to determine the tex-engine (regardless the output format). 

\end{itemize}


\section{Setting pom.xml and build.xml}\label{sec:sgml}

To install the maven-plugin within a given maven project, 
the listing of a pom entry given in Chapter~\ref{chap:settings} 
can be added to \texttt{pom.xml} and modified accordingly. 
In a default maven project, 
the default configuration is usable which creates pdf-documents and
\gls{html}-sites. 
The according entry to be added to the \texttt{pom.xml}
is then just the one given in Listing~\ref{lst:coords}. 
%
%\lstset{language=xml, basicstyle=\small}
\begin{lstlisting}[language=xml, basicstyle=\footnotesize,
escapechar=|,
float, captionpos=b, label={lst:coords}, 
caption={The coordinates of this plugin}]
<!-- create html and pdf and other formats from latex -->
<plugin>
  <groupId>|\groupId|</groupId>
  <artifactId>|\artifactId|</artifactId>
  <version>|\versionID|</version>
</plugin>
\end{lstlisting}
%
% TBD: add the plugin to mavencentral
Unfortunately, this plugin did not yet make it into maven central.
Thus one has to add the providers repository to the pom
as shown in Listing~\ref{lst:srcRepo}. 

\begin{lstlisting}[language=xml, basicstyle=\footnotesize,
escapechar=|,
float, captionpos=b, label={lst:srcRepo}, 
caption={The source repository for this plugin}]
<project ...>
  ...
  <repositories>
    <repository>
      <id>publicRepoAtSimuline</id>
      <name>repo at simuline</name>
      <url>|\repo|</url>
    </repository>
  </repositories>
  ...
</project>
\end{lstlisting}

To check whether the installation of the plugin succeeded,
in the directory of the pom command
%
\begin{Verbatim}
mvn latex:vrs
\end{Verbatim}
%
which shall return meta info, above all the version of the plugin,
which is
% 
\begin{Verbatim}
\versionID,
\end{Verbatim}
%
and a list all converters needed
together with the actual versions and the expected versions.
Note that not all converters need to be installed.
For details see Section~\ref{sec:devel}.
%TBD: maybe better split that section accordig to goals. 


Likewise to install the ant-task within an ant-project, 
the listing of a build file entry given in Chapter~\ref{chap:settings} 
has to be added to the \texttt{build.xml}. 
Also working with an ant project 
conforming with maven conventions, 
no explicit configuration is needed. 
\index{ant-task}

In both cases, add configuration, 
where a deviation from the default requires to do so. 



\section{Installation from source}\label{sec:instSrc}

To install from source, just clone from the repository by
%
\begin{Verbatim}[commandchars=\\\{\}]
git clone \devSite{}
\end{Verbatim}
%
of course assuming that \texttt{git} has been installed.
Then to install the maven-plugin, just type 
%
\begin{Verbatim}
mvn clean install
\end{Verbatim}
%
To install the ant-task, one has first to comment out in \texttt{build.xml} 
the task definition \texttt{latex} and the target \texttt{latex:cfg}. 
One may also adapt the lib-folder of the ant-installation, 
i.e.~the property \texttt{antJarDir} where \texttt{ant.jar} resides. 
Then just type \texttt{ant clean jar} 
which creates the jar-file (property \texttt{createdJar}) defining the ant-task. 
After that one may copy the created jar into folder \texttt{antJarDir}, 
where ant finds it typing \texttt{sudo ant install}. 
\index{ant-task}

Note that, if maven is installed, the command \texttt{mvn clean install} 
also creates the jar-file \texttt{createdJar} defining the ant-task. 
Also with this method, one has to copy the jar-file defining the ant-task 
later into ant's lib-folder. 

After having installed the ant-task, 
reactivate the taskdef \texttt{latex} and the target \texttt{latex:cfg} 
and run \texttt{ant latex:cfg} to create this manual. 

Mixing ant and maven builds is not so good. 
One may always recover by just creating with maven. 

\subsection{Test}

\chapter{Usage of Plugin and Task}\label{chap:usage}

% TBD: in the long run: plugin, task and standalone, or as a dependency
This software offers both, a maven plugin and an according ant task
but the emphasis is on the maven plugin.
Thus all sections of this chapter are either general
or apply to the maven plugin.
Only Section~\ref{sec:usageAntTask} specifically refer to the ant task. 
Usage presupposes installation as described in Chapter~\ref{chap:install}
including settings in \texttt{pom.xml}
as described in Section~\ref{sec:sgml}.

This plugin may be used both if the \LaTeX-sources are finished 
to create the output described by them 
and also to support development of the \LaTeX{} sources. 
Accordingly, this chapter has Section~\ref{sec:sources}
devoted to the form of the sources, including directory structure,
\LaTeX-files and others, mainly graphic files included
and a section, \ref{sec:stableUsage} on exporting into various formats.

There is a very special usage, called information development,
which means while the document is under construction.
The features and goals tied to this phase
are collected in Section~\ref{sec:devel}.

In contrast, Section~\ref{sec:usageLifecycle}
is on usage of the maven plugin within the lifecycles.
This can be used during information development
but is more appropriate for small changes
or when development finished at a stage. 



\section{The source files}\label{sec:sources}

The \LaTeX-files and also files included via \cmd{input}{} 
are in the {\em tex-source directory}, 
\index{tex-source directory}
which is by default \texttt{./src/site/tex}, 
where \texttt{.} is the {\em base directory\/} of this maven-project. 
\index{base directory}
The \LaTeX-files to be compiled top level, 
typically not inputted anywhere via \cmd{input}, 
are called {\em \LaTeX{} main files}. 
As an example, 
in the {\em tex-source directory\/} of this software, 
\texttt{manualLatexMavenPlugin.tex} is a \LaTeX{} main file, 
whereas the file \texttt{header.tex} is not although also a \LaTeX-file. 
% identification of the latex main file?
\LaTeX{} main files are detected automatically. 
\index{latex main file}

The included files may be again \LaTeX-files but also graphic files 
in various formats. 
There are four kinds of graphic formats, 
as regards the way their files are included in \LaTeX-files, 
all included in the tex-source directory. 
%
\begin{enumerate}
\item
The first can be included into \LaTeX-files directly via \cmd{input}. 
These formats are essentially \LaTeX{}
and are defined in an according package. 
Examples are \pkg{eepic} described in~\cite{EEpic}
and above all \pkg{tikz} described in~\cite{TikzPGF}. 
\item
the second one via the command \cmd{includegraphics}{} 
defined by the package \pkg{graphicx} 
which is described in~\cite{GraX}. 
Chapter 2 therein mentions the supported drivers, 
among these are also \texttt{dvipdfm} and \texttt{dvipdfmx}. 
It is not the package but the driver 
which decides on the support of graphic formats. 
The dvipdfm user manual,~\cite{DviPdfMx} lists the allowed formats 
metapost-output (i.e.~\gls{mps}), postscript, 
\gls{pdf}, \gls{jpg} and \gls{png}. 
\item\label{it:transExp}
the third one must be transformed into a graphics format 
of one of the former two kinds using an external tool for transformation. 
Here, of course, only a limited support is possible, 
because there is a broad variety of formats. 
We have chosen
%
\begin{itemize}
\item
the \gls{fig}-format described in~\cite{XFigF}
because of its simplicity, 
\item
the gnuplot format , described in~\cite{GnuPlot}, 
because it allows computation of function plots, 
\item
  scaleable vector graphics svg format specified in~\cite{Svg11} 
  as it is important for construction and the counterpart of pixel oriented
  formats.
  As the specification is hard to digest,
  we refer to the tutorial \cite{SvgTut}. 
\item
  likewise metapost (\gls{mp}-format),
  described in~\cite{MPost} because it is native to \LaTeX
  and quite versatile. 
\end{itemize}
\item\label{it:transImp}
finally the fourth kind of graphics formats 
has to be transformed into one of the kinds one or two 
but unlike in type three, this is not done explicitly 
by an external tool but by a latex-package during the \LaTeX-run. 
Note that, although not required to be explicitly transformed, 
those graphics files induce additional files 
by running \LaTeX.
Essentially, each of the abovementioned type of format
can be included that way but currently,
this is done for the \gls{svg}-format only
included by the package \pkg{svg} (see \cite{SvgP}).
The author personally refrains from using packages like that
because of the lack of flexibility and further advantages. 
\end{enumerate}

The \LaTeX-files and the graphic files belonging to a \LaTeX{} main file 
are assumed to be in one single folder. 
If one file is included by two different main files, 
a link shall be used.
%TBC: True???

Note that unlike former version, 
the current version of this software does not create a working directory 
by cloning the tex-source directory. 
Instead, it operates directly on the tex-source directory 
also creating intermediate files.
The advantage of processing that way is,
that this allows cooperation between this software
and other toolchains which are better suited for developping latex files.
Details are described in Section~\ref{sec:devel}.

The downside is that a file residing in the tex-source directory 
risks being overwritten by this software, 
if it does not stick to the rules. 
The rules are simple: 
For each graphic file, being transformed, 
i.e.~of types~\ref{it:transExp} or~\ref{it:transImp} above, 
additional files are created with the same name up to the suffix. 
Thus for these graphic files no file with the same name 
up to the ending is allowed. 
The same is true for the \LaTeX{} main files.

Besides the \LaTeX-files and the graphics files
there is a third kind of file supported:
Bibliographies in bib-files.
This software treats them automatically. 


\section{Exporting in various formats}\label{sec:stableUsage}


After having added the configuration of the plugin to the \texttt{pom.xml},
minimally the one given in Section~\ref{sec:sgml},
it can be used directly invoking maven through 
\texttt{mvn latex:cfg}. 
Here \texttt{latex} is the (short) name of the plugin 
and \texttt{cfg} is the goal. 
It can also be interpreted as \texttt{mvn $<$source$>$:$<$target$>$}: 
The source files are in \texttt{latex}-format and the target-formats 
are read from the {\em configuration\/} in the pom 
({\em configuration\/} is what \texttt{cfg} stands for). 

By default, the target formats are \texttt{pdf} and \texttt{html}. 
The following Listing~\ref{lst:targetsAll} shows a configuration 
with the full range of output formats including in addition 
the open office document format \texttt{odt}, 
the MS word-formats \texttt{doc(x)} and \texttt{rtf} % chktex 36
and also plain text format \texttt{txt} in utf8 encoding. 
Note that the target \texttt{docx} converts by default into \gls{docx} 
but may also be configured to produce the old fashioned \gls{doc} format. 
%
%\lstset{language=xml, basicstyle=\small}
\begin{lstlisting}[language=xml, basicstyle=\small,
escapechar=|,
float, captionpos=b, label={lst:targetsAll}, 
caption={Configuration with full range output formats}]
<!-- create html and pdf and other formats from latex -->
<plugin>
  <groupId>|\groupId|/groupId>
  <artifactId>|\artifactId|</artifactId>
  <version>|\versionID|</version>
	
  <configuration>
    <settings>
      <targets>pdf, html, odt, docx, rtf, txt</targets>
    </settings>
  </configuration>
</plugin>
\end{lstlisting}

The resulting files in the given output formats 
are copied to the site directory, 
which is \texttt{./target/site} in a default maven project. 

Sometimes it is more convenient 
to specify the output formats not via the pom 
but directly as a goal on the command line. 
In particular, one may write \texttt{mvn latex:pdf} to create documentation 
in pdf-format only.
Likewise command \texttt{mvn latex:dvi} to get good old dvi files
or even \texttt{mvn latex:txt} for plain text, just as examples. 
Note that the \texttt{-X} switch activates debugging 
which results in a more verbose output. 
Example: \texttt{mvn -X latex:cfg}. 

For creating the graphic files in the tex-source directory, 
there is a goal {\em graphics}, invoked by \texttt{mvn latex:grp}. 
This goal does not create any output in the site directory. 
Instead it populates the source directories 
with graphic files which can be directly included into the \LaTeX-file 
and so it allows to run the \LaTeX-compiler on the latex main files 
from within a development environment. 
Thus the goal {\em graphics\/} is thus a vital feature 
for information development. 


Finally, there is another target for clearing the tex-source directory 
recursively, invoked by \texttt{mvn latex:clr}. 
For more details on the last three goals, see Section~\ref{sec:devel}. 

In a standard maven project, 
the above minimal configuration should be sufficient. 
Only if the folder structure deviates from the standard 
or if the \LaTeX{} sources require special configuration, 
parameters have to be given explicitly, 
because they deviate from the default values. 
Chapter~\ref{chap:settings} summarizes all available parameters, 
giving the default value and a description. 


For sake of uniformity, 
the name of the ant-task is \texttt{latex:cfg} 
and it can be invoked via \texttt{ant latex:cfg}. 
Unlike the maven-plugin, the ant-task 
does not allow to specify a target on the command line. 
The \texttt{-d} switch activates debugging 
which results in a more verbose output. 
Example: \texttt{ant -d latex:cfg}. 

Whereas by default the target directory and in particular 
the target site directory with all output of this plugin is deleted 
in maven's \texttt{clean} life-cycle. 
As is described in more detail in Section~\ref{sec:devel}, 
this software creates target documents and also intermediate files 
in the tex source directory, at least with cleanup disabled. 
To eliminate the created files from the source directory, 
just type \texttt{mvn latex:clr}. 
By default, the goal \texttt{clr} 
is also executed in maven's \texttt{clear} life-cycle. 

There is an according ant-task \texttt{latex:cfg} 
which can be invoked via \texttt{ant -d latex:cfg}. 
FIXME\@: ant  \texttt{latex:clr} has duplicate parameters. 
This can be fixed only by properties. 
Another problem is, to provide a complete subset of parameters 
which apply to \texttt{latex:cfg} and to \texttt{latex:cfg}, respectively. 

If this ant-task is used in an ant project 
with folder structure conforming with a maven project 
and if the \LaTeX{} sources do not require a special configuration, 
the above configuration is sufficient. 
Otherwise, parameters have to be given explicitly 
overwriting the default values. 

\section{Information development }\label{sec:devel}

During development, it is comfortable, 
to have the log-file in the same directory as the \LaTeX{} main file. 
Also if pdf- and tex-files are synchronized, 
% FIXME: reference to package 
also the pdf-file should be in the same directory. 
Likewise, files in graphic formats 
which cannot be included into a \LaTeX-file without conversion, 
that converted file shall be in the same directory as the original one. 
So, all files, manually created files 
and files arising from automatic conversions 
shall be in the same folder, at least during development. 
Also, typically, one wants to mix creation by this maven-plugin or ant-task 
with at least partial creation through external tools. 
For example, if writing \LaTeX-files with Emacs, 
it is much more convenient, to compile the \LaTeX{} main file 
via \texttt{pdflatex} from within Emacs 
or to create a pdf-file from a \gls{fig}-file 
through \texttt{xfig}'s export dialog, 
than using this maven-plugin or this ant-task. 
Also these tools work best, if all is in one folder. 

On the other hand, 
conventionally, in a maven project, 
sources are held in folder \texttt{src}, 
whereas created files occur in the folder \texttt{target}. 
Likewise for ant. 
The compromise, this maven-plugin and this ant-task take, 
is, that at the end of a run, 
at most the files present at the beginning of the run 
may be present in the source directory. 
So, this software builds in the following steps: 
%
\begin{itemize}
\item
Store a list of all files present at the beginning of a run.
\item
Process all graphics files of the formats requiring preprocessing.
\item
Determine the \LaTeX{} main files.
\item
Run the \LaTeX{} converter, e.g.~the one creating pdf-output or docx-output.
\item
Copy the result files (if any) into the target folder.
\item
Remove all files not present at the begin of a run, by default. 
% FIXME: maybe different for goal chk. 
\end{itemize}

To keep e.g.~the resulting pdf, 
just create it via compilation through Emacs, 
even if not all graphic files to be included are present 
or just by a \texttt{touch}-command. 
Then in the next run of this plugin, 
this pdf will be re-created, 
that time complete with the graphics output. 
That way, synchronization between \LaTeX- and pdf-files is possible. 
Likewise, to keep the log-file or the aux-file, just touch it. 
This technique is really valuable for debugging. 

To keep all created files after a run of this maven-plugin, 
set the parameter \texttt{cleanUp} in the pom 
to \texttt{false} as illustrated in Listing~\ref{lst:noCleanup}. 
For the ant-task likewise. 

%\lstset{language=xml, basicstyle=\small}
\begin{lstlisting}[language=xml, basicstyle=\small,
escapechar=|,
float=b, captionpos=b, label={lst:noCleanup},
caption={Configuration without cleanup}]
<!-- create html and pdf and other formats from latex -->
<plugin>
  <groupId>|\groupId|</groupId>
  <artifactId>|\artifactId|</artifactId>
  <version>|\versionID|</version>
	
  <configuration>
    <settings>
      <targets>pdf</targets>
      <cleanUp>false</cleanUp>
    </settings>
  </configuration>
</plugin>
\end{lstlisting}


But how can one get rid of all these newly created files? 
That is what is the goal \texttt{latex:clr} is for: 
% 
\texttt{mvn latex:clr}
%
removes all created graphic files 
and for each latex main file, it removes all files with ``similar'' names
including log files, index files and that like.
Typically, this suffices, to remove all files created. 
If not, 
try to modify parameter \texttt{\$patternCreatedFromLatexMain} 
in the pom accordingly. 
If this does not help either, please inform the developer of this software. 
Of course, if further software is used which creates additional files, 
like Emacs creates a folder \texttt{auto}, 
these files cannot be removed by this maven-plugin or this ant-task.
Note that \texttt{latex:clr}
also removes exported files as listed in Section~\ref{sec:stableUsage}
from the target folder. 

During development of a \LaTeX-main file, 
it is often more convenient to compile from within an editor like Emacs. 
The problem is, that compilation fails if the graphic files are missing. 
This is what the goal {\em graphics\/} accessible via 
% 
\begin{Verbatim}
mvn latex:grp
\end{Verbatim}
%
is for: 
It creates all graphic files required to compile the \LaTeX-main files. 

Still this does not create a bibliography, an index or a glossary. 
With {\em auctex\/}\index{auctex}, an Emacs-package for editing \LaTeX, 
bibliography and index are well supported. 
To create a glossary, auctex has to be modified a little. 

%FIXME\@: include this into auctex. 

That way also the log-files required are created: 
In case of this manual, 
the files \texttt{manualLatexMavenPlugin.xxx} are created 
where \texttt{xxx} is 
%
\begin{itemize}
\item
\texttt{log} for \LaTeX, 
\item
\texttt{blg} for \texttt{BibTeX}, 
\item
\texttt{glg} for \texttt{makeglossaries} and 
\item
\texttt{ilg} for \texttt{makeindex}. 
\end{itemize}

The last goal regularly used for information development is {\em check}. 
It is invoked via 
% 
\begin{Verbatim}
mvn latex:chk
\end{Verbatim}
%
and runs \texttt{chktex}, described in~\cite{ChkTeX}, 
on each latex main file 
after having created graphic files as for goal {\em graphics}. 
As a result, a log-file with suffix \texttt{.clg} is created 
but not copied to the target folder. 
If the log-file contains an entry, 
an according message is logged. 
% FIXME: there is a lot more to do here. 
Note that, with default configuration, 
\texttt{chktex} requires the \LaTeX-package \pkg{booktabs} 
described in~\cite{BooktP}. 

% rsvg-convert -f pdf -o t.pdf t.svg
% inkscape t.svg --export-pdf=t.pdf
% convert file.svgz file.pdf 
% rasterizer -m application/pdf file.svgz -d file.pdf
% cairosvg in.svg -o out.pdf
% yyy

Finally, we have the goal \texttt{latex:vrs}
to display meta information, above all version information:
% 
\begin{Verbatim}
mvn latex:vrs
\end{Verbatim}
%
displays something like what is displayed in Listing~\ref{lst:vrsOut}.
As one can see, there may be converters with inapropriate versions
which is indicated by a warning WMI02 
and there may be converters which are excluded
according to the configuration \texttt{convertersExcluded}.

Note that in the given version and in the installation of the author,
of course, all converters are installed and are up to date
to be able to check validity.
The according messages are for illustration only. 
% TBC: what is an interface of a converter?
% Note that \texttt{makeindex} is not in the list.
% This is because it is not possible
% to regularly check the version of that application.
% It may be an option to use \texttt{upmendex} instead,
% although in beta state at time of this writing
% and not completely compatible.
% According to \cite{UpMendex}, \cite{MkIdxMoe}
% and further research,
% \texttt{upmendex} does not support options \texttt{-T} and \texttt{-L}
% and does interprete \texttt{-g} differently,
% namely as japanese instead of german. 


\begin{lstlisting}[basicstyle=\tiny,
float, captionpos=b, label={lst:vrsOut}, 
caption={Output of goal \texttt{latex:vrs}}]
[INFO] --- latex-maven-plugin:1.5-SNAPSHOT:vrs (default-cli) @ latex-maven-plugin ---
[INFO] Manifest properties: 
[INFO] MANIFEST: (1.0)
[INFO]        Implementation-Version: '1.5-SNAPSHOT'
[INFO] PackageImplementation-Version: '1.5-SNAPSHOT'
[INFO] pom properties:
[INFO] coordinate.groupId:    'eu.simuline.m2latex'
[INFO] coordinate.artifactId: 'latex-maven-plugin'
[INFO] coordinate.version:    '1.5-SNAPSHOT'
[INFO] git properties: 
[INFO] build version:  '1.5-SNAPSHOT'
[INFO] commit id desc: 'latex-maven-plugin-1.4-114-g1c03bb0-dirty'
[INFO] buildTime:      '2021-05-19T23:09:31+0200'
[INFO] tool versions: 
[INFO] ?warn?    command         'actual version'(not)in[expected version interval]
[INFO]           pdflatex:       '1.40.22'in[1.40.21;1.40.22]
[INFO]           lualatex:       '1.13.2'in[1.12.0;1.13.2]
[INFO]           xelatex:        '0.999993'in[0.999992;0.999993]
[INFO]           latex2rtf:      '2.3.18 r1267'in[2.3.16 r1254;2.3.18 r1267]
[INFO]           odt2doc:        '0.9.0'in[0.9.0]
[INFO]           pdftotext:      '21.10.0'in[21.04.0;21.10.0]
[INFO]           dvips:          '2021.1'in[2020.1;2021.1]
[INFO]           dvipdfm:        '20210318'in[20210318]
[INFO]           dvipdfmx:       '20210318'in[20200315;20210318]
[INFO]           xdvipdfmx:      '20210318'in[20200315;20210318]
[INFO]           dvipdft:        '20090604.0046'in[20090604.0046]
[INFO]           gs:             '9.54.0'in[9.52.0;9.54.0]
[INFO]           chktex:         '1.7.6'in[1.7.6]
[WARNING] WMI02: bibtex:         '0.99d'not in[0.99c]
[INFO]           bibtexu:        '3.71'in[3.71]
[INFO]           bibtex8:        '3.71'in[3.71]
[INFO]           makeindex:      '2.15'in[2.15]
[INFO]           splitindex:     '0.1'in[0.1]
[INFO]           makeglossaries: '4.45'in[4.45]
[INFO]           mpost:          '2.01'in[2.00;2.01]
[INFO]           ebb:            '20210318'in[20200315;20210318]
[INFO]           gnuplot:        '5.4 patchlevel 2'in[5.4 patchlevel 0;5.4 patchlevel 2]
[INFO]           inkscape:       '1.1.1'in[1.0.2;1.1.1]
[INFO]           fig2dev:        '3.2.8b'in[3.2.7b;3.2.8b]
[INFO] excluded tools: 
[INFO] upmendex, xindy
[INFO] ------------------------------------------------------------------------
\end{lstlisting}


\section{Goals in the maven lifecycle}\label{sec:usageLifecycle}

The goal \texttt{latex:cfg} exporting in the formats configured
is tied to the lifecycle phase \texttt{site} so is invoked
when commanding
%
\begin{Verbatim}[fontsize=\scriptsize]
mvn site
\end{Verbatim}
%
or subsequent phase.

Also the goal \texttt{latex:clr} cleaning created files
both from source directory and from target directory
is tied to phase \texttt{clear} so is invoked
when commanding
%
\begin{Verbatim}[fontsize=\scriptsize]
mvn clear
\end{Verbatim}

% TBD: maybe vrs or sth is tied to phase validate

\section{The ant-tasks}\label{sec:usageAntTask}

This section is missing.
What has to be described are the two tasks. 


\chapter{Graphical Preprocessing}\label{chap:GraphConversions}

While \LaTeX{} is really strong in text processing 
and also in formula processing, 
in itself it is weak in its graphical abilities. 
To include graphics into a \LaTeX-document, 
several \LaTeX-packages are required and must be installed: 
%
\begin{itemize}
\item[graphicx]
is the basic graphics package which provides the command 
\cmd{includegraphics}{} 
which allows to include graphics natively 
in the formats pdf, eps, jpg and png at least. 
For details see~\cite{GraX}. 
\item[xcolor]
allows to use colors in graphics. 
Even if the author does not use graphics, 
several formats, like \gls{fig}, \gls{gp} and \gls{svg} 
offer it and so the according converters 
transforming them into the native formats 
create color information and so the package must be installed 
if using those formats. 
For details see~\cite{XColorP}. 
\item[transparent]
allows to specify transparency in graphics. 
Here the same applies as for color: 
Even if you do not use the feature, 
some source formats do (in fact only \gls{svg}) does 
and so the according converters create according information 
and so \LaTeX{} must get along with it. 
For details see~\cite{TransP}. 
\item[bmpsize]
is needed for bitmap formats like \gls{jpg} and \gls{png} only. 
Used to extract resolution and bounding box. 
FIXME\@: needed more information. 
For details see~\cite{BmpP}. 
\item[import]
is strictly speaking no graphics package. 
According to its documentation~\cite{ImpoP}, 
it allows an imported file to find its own inputs 
(using ``\cmd{input}'', ``\cmd{includegraphics}'' etc.) in that directory. 
This is vital for the graphic formats for which a tex-file is imported 
which itself imports a pdf/eps file located in the same folder 
but not in the folder of the importing file. 
\end{itemize}

We support figures created in the \gls{fig} by the program xfig, 
figures created by the plotting utility \texttt{gnuplot}, 
the tex-specific graphic language metapost, 
figures in \gls{svg}-format 
and finally figures in formats which can be included into a \LaTeX-file 
without preprocessing like \gls{png} and \gls{jpg}. 
Further functionality on \LaTeX{} figures can be easily added. 
If there is some need, please write an email to the author. 

Table~\ref{tab:graphicOverview} gives an overview over the supported formats 
together with the graphic converters, 
the name of the parameter to configure which one is used 
and the default value. 
Of course this converter must be installed. 
It is advisable to have also an editor installed. 
Sometimes the editor is used also as converter. 
For human readable formats like \texttt{fig}, it often makes sense, 
to use both the graphical editor and the textual one. 

\begin{longtable}{|l|ll|}
\toprule
Graphic format & conversion tool & editor \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:graphicOverview} 
Overview over the supported graphic formats }
\endlastfoot%
fig             & \texttt{fig2devCommand}, e.g.~\texttt{fig2dev}  & xfig, emacs   \\
gnuplot (gp)    & \texttt{gnuplotCommand}, e.g.~\texttt{gnuplot}  & emacs         \\
metapost (mp)   & \texttt{metapostCommand}, e.g.~\texttt{mpost}   & emacs         \\
svg             & \texttt{svg2devCommand}, e.g.~\texttt{inkscape} & inkscape      \\
jpg, png        & ---        & gimp          \\
\end{longtable}

Besides the converter external to \LaTeX, 
also several \LaTeX-packages are required 
to use graphics. 


This section describes the conversions of 
graphical source files into target files 
in detail. 

But pdf also occurs as an intermediate format for pictures. 
For historical reasons, still \gls{eps} is used. 
Section~\ref{sec:figpdf} shows that it suffices to stick to pictures 
in pdf-format. 
% FIXME\@: REALLY? 
%FIXME\@: missing pdf als basic input format. What about (e)ps? 
Section~\ref{sec:fig2dev} shows how \texttt{fig2dev} converts fig-files 
into \LaTeX-files containing text and including graphics in as pdf-files. 
Likewise, Section~\ref{sec:gnuplot2dev} describes 
how gnuplot converts gnuplot-files into pdf-files. 
An interesting alternative to gnuplot for computing pictures 
is metapost described in Section~\ref{sec:metapost}. 
A more elaborate alternative to fig-pictures are svg-pictures 
described in Section~\ref{sec:picSvg}
Also several formats collected in Section~\ref{sec:picasis} 
may be included as is. 



\section{Including pdf-files}\label{sec:figpdf}

Modern \LaTeX{} implementations directly create pdf-files. 
Thus it makes sense, to allow including graphics as pdf-files 
in \LaTeX-files. 
This is done in pdf mode 
by the \LaTeX-packages \pkg{xcolor} and \pkg{graphicx}. 
In contrast, traditionally \LaTeX{} produced output in the \gls{dvi}-format 
which is still used to create \gls{html}-output, 
this is not supported by the default driver, 
Instead it shall be used the driver \texttt{dvipdfmx}. 
To obtain a \LaTeX-file which works both for creating pdf and html, 
insert in the header of the \LaTeX{} main file
given by Listing~\ref{lst:header}. 
%
%\lstset{language=tex, basicstyle=\small}
% FIXME\@: nag complains for htlatex 
\lstinputlisting[firstline=9, lastline=21,
language=tex, basicstyle=\small,
float, captionpos=b, label={lst:header}, 
caption={The header of the tex-source of this manual}]%
{header.tex}

An alternative, which we do not use 
is replacing the pdf by an \gls{eps} via configuration file \texttt{myxhtml.cfg} 
which is given by Listing~\ref{lst:xhtml}. 
%
%\lstset{language=tex, basicstyle=\scriptsize}
% FIXME\@: nag complains for htlatex 
\lstinputlisting[language=tex, basicstyle=\scriptsize,
float, captionpos=b, label={lst:xhtml},
caption={Configuration file \texttt{myxhtml.cfg}}]
{myxhtml.tex}
%
It applies when converting \LaTeX{} into html and that like 
with htlatex if invoking something like \texttt{htlatex xxx.tex myxhtml,\ldots} 
where \texttt{myxhtml} is located in the same directory as the \LaTeX-file 
to be processed. 
The configuration file essentially contains a graphics configuration, 
which applies conversion to pdf-files included in the \LaTeX-file \texttt{xxx.tex}
via \cmd{includegraphics}. 


\section{Conversion of fig-files}\label{sec:fig2dev}

\index{xfig}
\index{fig2dev}
A simple but still useful tool to draw figures is \texttt{xfig} 
which stores graphics in a native format 
described in~\cite{XFigF} with file extension \texttt{.fig}. 
The file extension \texttt{.fig} is also used by matlab to store plots 
but this is something different. 
Graphics in xfig format cannot be directly included in latex files 
but must be exported into a \LaTeX-readable format. 

To export a file \texttt{xxx.fig} residing in directory \texttt{yyy} 
into several external formats, 
\texttt{xfig} uses \texttt{fig2dev}. 
A look in~\cite{XFigF}, Section~3.4 shows that texts with set ``special''-flag 
are interpreted as latex-code. 
For these texts the appropriate export language would be \texttt{latex}. 
On the other hand, \texttt{latex} is weak in graphics 
and \texttt{pdf} would be the ideal export format for all kinds of objects, 
except for texts with set ``special''-flag. 
In \texttt{pdf} format, texts are interpreted literally, 
independent of the ``special''-flag. 
Thus \texttt{fig2dev} offers a mixed solution: 
export \texttt{xxx.fig} in format \texttt{pdftex} which yields a pdf-file 
\texttt{xxx.pdf} containing all but text with set ``special''-flag 
and complementary \texttt{pdftex\_t} which yields a tex-file \texttt{xxx.ptx} 
including the pdf-file and the texts with set ``special''-flag. 
\index{special-flag}%maybe glossary 
The exported files are in the same directory \texttt{yyy} 
as the original file \texttt{xxx.fig}. 

For example, 
the fig-file \texttt{F4\_01fig2dev.fig} defining Figure~\ref{fig:fig2dev}, 
is transformed into a file \texttt{F4\_01fig2dev.ptx} 
in format \texttt{pdftex\_t} which starts as given by Listing~\ref{lst:ptx}. 

%\lstset{language=tex, breaklines, basicstyle=\footnotesize}
% FIXME\@: nag complains for htlatex 
\lstinputlisting[language=tex, basicstyle=\tiny,
breaklines, lastline=25,
float, captionpos=b, label={lst:ptx}, 
caption={The ptx-file for a fig-file}]{F4_01fig2dev.ptx}

The file \texttt{xxx.ptx} is ``imported'' into the tex-file of this manual 
by the command 
%
\begin{lstlisting}[language=TeX]
\import{yyy}{xxx.ptx}
\end{lstlisting}
%texttt
and includes \texttt{xxx.pdf} automatically the file \texttt{xxx.pdf} 
via \cmd{includegraphics\{xxx\}}{} (line 2). 
Note the following remarkable details: 
%
\begin{itemize}
\item
Observe that we can drop the suffix of the included file \texttt{xxx.pdf} 
which is expressed as ``\texttt{xxx}'' 
because \LaTeX{} chooses the right suffix: 
If instead of \texttt{xxx.pdf} there is a file \texttt{xxx.eps}, 
the latter is chosen if no suffix is specified. 
As we will see below, 
omitting the suffix is crucial to make \texttt{xxx.ptx} work 
for both \LaTeX-output formats: 
the pdf-format can include pdf-files, 
whereas the dvi-format which is required to create html- and
odt-files can include eps-files. 
\item
If \texttt{xxx.pdf} is included in \texttt{xxx.ptx} 
with the full path name, 
we may use \cmd{input\{xxx.ptx\}}{} instead of \cmd{import\{yyy\}\{xxx.ptx\}}. 

If in contrast, \texttt{xxx.pdf} is included in \texttt{xxx.ptx} 
with the short name only, 
\texttt{xxx.pdf} is assumed to be in the same directory 
as the file inputting \texttt{xxx.ptx}. 
So in general, i.e.~if this is not \texttt{yyy}, we need import 
\cmd{import\{yyy\}\{xxx.ptx\}}. 
If the directories coincide, 
in the import the string \texttt{yyy} may be empty. 
If the string \texttt{yyy} is not empty, it must end with the path delimiter, 
i.e.~\texttt/ for Unix like systems and 
\texttt{\textbackslash} for win-like systems. 
\end{itemize}

As indicated in Section~\ref{sec:figpdf}, 
the commands in \texttt{xxx.ptx} 
require the packages \pkg{graphicx} and \pkg{xcolor}. 
Also the \cmd{import}{} command 
requires the \pkg{import} package. 

To export \texttt{xxx.fig} into \texttt{xxx.ptx} and \texttt{xxx.pdf} 
this software invokes two commands: 
%
\begin{Verbatim}[fontsize=\scriptsize]
fig2dev -L pdftex   <fig2devGenOptions> <fig2devPdfEpsOptions>        xxx.fig xxx.pdf   
fig2dev -L pdftex_t <fig2devGenOptions> <fig2devPtxOptions>    -p xxx xxx.fig xxx.ptx
\end{Verbatim}
%
Both commands specify the input file \texttt{xxx.fig}, 
both use the options given by the parameter \texttt{fig2devGenOptions} 
while each invocation allows to specify also specific options, 
\texttt{fig2devPdfEpsOptions} and \texttt{fig2devPtxOptions}, respectively, 
and both use the option \texttt{-L} 
to specify the output format (``language''). 

%FIXME\@: ptx-->tex and then: convention: intuitive suffixes 

The parameters specific for \texttt{pdftex} 
are called \texttt{fig2devPdfEpsOptions} 
because the options available are the same 
as for output format \texttt{pstex} creating eps-files. 
An example for a common option would be \texttt{-b width} 
which shall specify the same boundary for both formats; 
otherwise they do not fit. 

For the output format \texttt{pdftex\_t}, 
the option \texttt{-p xxx} says, 
that the string \texttt{xxx} must be included in \texttt{xxx.ptx} 
as \cmd{includegraphics\{xxx\}}. 
Note that the option \texttt{-p} shall not be specified 
in \texttt{fig2devPtxOptions}, because it is automatically added. 

Equivalent to mixed export with formats \texttt{pdftex} and \texttt{pdftex\_t} 
which is appropriate for \LaTeX-output format pdf, 
is the mixed export with the according formats 
\texttt{pstex} and \texttt{pstex\_t} appropriate for \LaTeX-output format dvi. 
The difference is that \texttt{pstex} creates an eps-file instead of a pdf-file 
with the same content 
and \texttt{pstex\_t} creates a tex-file which looks like that 
created by \texttt{pdftex\_t} except including the eps-file 
instead of the pdf-file. 
If the suffix is not given, 
\texttt{pstex\_t} and \texttt{pdftex\_t} create identical files. 
Thus exporting \texttt{xxx.fig} via 
%
\begin{Verbatim}[fontsize=\scriptsize]
fig2dev -L pstex    <fig2devGenOptions> <fig2devPdfEpsOptions>        xxx.fig xxx.eps   
fig2dev -L pdftex   <fig2devGenOptions> <fig2devPdfEpsOptions>        xxx.fig xxx.pdf   
fig2dev -L pdftex_t <fig2devGenOptions> <fig2devPtxOptions>    -p xxx xxx.fig xxx.ptx
\end{Verbatim}
%
and ``inputting'' \texttt{xxx.ptx} works for both \LaTeX{} output formats. 


Note that \texttt{xfig} chooses its file suffix 
according to Table~\ref{tab:xfigSuffixes} 
which deviate from those used by this software. 
The suffixes used here, 
better reflect the file formats. 
We opted for the quite unusual suffix \texttt{.ptx} 
instead of \texttt{.tex} 
to avoid that tex-files may be both, 
source files and created files, 
but this is not compulsory, 
since the same holds and is accepted for pdf-files. 

\begin{longtable}{|l|lll|}
\toprule
Output format (language) & xfig suffix & our suffix & format \\
\midrule
\midrule
\endfirsthead%
\bottomrule%
\caption{\label{tab:xfigSuffixes} Suffixes used by xfig as opposed to suffixes
  used here and actual file format }
\endlastfoot%
pstex                    & pstex       & eps        & eps \\
pstex\_t                 & pstex\_t    & ptx        & tex \\
pdftex                   & pdf         & pdf        & pdf \\
pdftex\_t                & pdf\_t      & pdf        & pdf \\
\end{longtable}


Maybe xfig is intended to export from within the export dialog 
and not directly via a script like \texttt{fig2dev}. 
This may be the reason 
why the magnification must be set in the export dialog, 
but it is stored in the fig-file nevertheless. 

Figure~\ref{fig:fig2dev} shows the transformation 
of figures with \texttt{fig2dev} 
and the inclusion of the eps-file and of the pdf-file in the ptx-file. 
Note that the \texttt{fig2dev}-command is configurable 
via the parameter \texttt{fig2devCommand}, 
but there will be hardly any command with the same command line interface 
performing exactly the transformations given in Figure~\ref{fig:fig2dev}, 
except \texttt{fig2dev} itself. 

At the same time, Figure~\ref{fig:fig2dev} is an example 
for a \LaTeX-file \texttt{xxx.ptx} created from a fig-file 
and embedded in this \LaTeX-file 
with the \cmd{input}-command. 
More than that, 
Figure~\ref{fig:fig2dev} describes the way it has been created. 
Note that all text labels are specified with set ``special''-flag, 
and are thus included as \LaTeX-text, 
except the text \textbf{\tiny postscript} 
which is typeset with a postscript font to make the difference visible. 


\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F4_01fig2dev.ptx}
}
\caption{\label{fig:fig2dev}Conversion of a fig-file 
into pdf-, eps- and ptx-files with inclusions}
\end{figure}


\section{Conversion of gnuplot-files}\label{sec:gnuplot2dev}

The term ``gnuplot'' refers to a file format
and to a program \texttt{gnuplot}
which can read this format, both described in \cite{GnuPlot}. 

Note that there seems no official file extension 
to identify gnuplot files. 
From the most common extensions \texttt{.plt}, \texttt{.gpi} and \texttt{.gp} 
we have chosen the one with the least collision 
and supported by Emacs and by my file browser: \texttt{.gp}. 
% FIXME\@: should be configurable.
% FIXME\@: look at https://www.file-extensions.org/

The gnuplot format is a textual command language you can even program with 
and may thus be created with any editor but
for sake of reproducibility it is recommended to use only files
created by \texttt{gnuplot}.
To ensure that a hand-written gnuplot file \texttt{xxx.gp},
e.g. with a single line like
%
\begin{verbatim}
plot [-10:10] sin(x), atan(x), cos(atan(x))
\end{verbatim}
%
really works
with the current \texttt{gnuplot} and to see how it is interpreted,
it is recommended to convert it via
%
\begin{lstlisting}
gnuplot -persist -e "load 'xxx.gp'; save 'xxx.gp'"
\end{lstlisting}
%
If you have a look inside, you can see, that in a comment line
the current version of \texttt{gnuplot} is documented
and also all the settings implicitly used.
The original line is the last but one.

Also if a gnuplot file is created with an old version of \texttt{gnuplot},
it is recommended to update version with the same command.
Note that \texttt{gnuplot} does not offer full backward compatibility. 


This software supports including 
figures stored in \texttt{.gp}-files created by \texttt{gnuplot}.
To export a file \texttt{xxx.gp} into several external formats, 
it uses \texttt{gnuplot} itself. 
According to the manual~\cite{GnuPlot}, Part IV, 
\texttt{gnuplot} supports output formats through so called {\em terminals}. 
Among those are several ones intended for inclusion into \LaTeX-files, 
like \texttt{Cairolatex}, \texttt{Eepic}, \texttt{Epslatex}, 
\texttt{Latex}, \texttt{Lua}, 
\texttt{Mf}, \texttt{Mp}, \texttt{Postscript}, \texttt{Ps(la)tex}, % chktex 36
\texttt{Pstricks}, \texttt{Texdraw} and \texttt{Tpic}. 
Note that also export into the fig-format via the terminal \texttt{Fig} 
is supported which in turn may be included in latex 
as described in Section~\ref{sec:fig2dev}. 
Also \texttt{gnuplot} pictures may be exported in metapost format 
which in turn may be included in latex 
as described in Section~\ref{sec:metapost}. 

This software supports the export of a file \texttt{xxx.gp} 
only via the terminal \texttt{Cairolatex} 
which offers export to mixed pdf and \LaTeX\@: 
graphics in pdf and text in \LaTeX{}
which yields the fonts typical for \LaTeX. 
This is as described for fig-files in Section~\ref{sec:fig2dev}, 
except that text is generally converted in \LaTeX{}-format, 
and not selectively those text marked with special flag. 

Accordingly, the export yields two files \texttt{xxx.ptx} and
\texttt{xxx.pdf}, both in the directory \texttt{yyy} 
in which \texttt{xxx.gp} resides. 
The file \texttt{xxx.ptx} must be imported via 
%
\begin{lstlisting}[language=TeX]
\import{yyy}{xxx.ptx}
\end{lstlisting}
%
It contains the texts and includes \texttt{xxx.pdf} 
via \cmd{includegraphics\{xxx\}}{} without specifying a suffix. 

Unlike for fig-files, 
\texttt{xxx.ptx} and \texttt{xxx.pdf} are created with a single command: 
%
\begin{verbatim}
gnuplot -e "set terminal cairolatex pdf <gnuplotOptions>;
            set output 'xxx';
            load 'xxx.gp'"
\end{verbatim}

Accordingly, 
\texttt{xxx.ptx} and \texttt{xxx.eps} are created with a single command: 
%
\begin{verbatim}
gnuplot -e "set terminal cairolatex eps <gnuplotOptions>;
            set output 'xxx';
            load 'xxx.gp'"
\end{verbatim}
%
Note that this writes another but identical file \texttt{xxx.ptx}. 
Thus performance is not optimal, 
but \texttt{gnuplot} offers no way to avoid this. 
If being strict, 
\texttt{xxx.ptx} is perfectly correct only for output \texttt{eps},
% TBC: in which respect? 
if comments and error messages are taken into account 
but as long as no error occurs, 
the result is perfectly ok also for \texttt{pdf}. 

As for inclusion of fig-files, 
packages \pkg{graphicx} and \texttt{color} are needed. 


%FIXME\@: 
%Here further options are missing: 
%   // set terminal pdf {monochrome|color|colour}
%    //                      {{no}enhanced}
%    //                      {fname "<font>"} {fsize <fontsize>}
%    //                      {font "<fontname>{,<fontsize>}"}
%    //                      {linewidth <lw>} {rounded|butt}
%    //                      {solid|dashed} {dl <dashlength>}}
%    //                      {size <XX>{unit},<YY>{unit}}

Figure~\ref{fig:gp2pdf} shows the transformation of the plots 
and the inclusion of graphic files. 
In addition, Figure~\ref{fig:gnuplot} shows an example of a \LaTeX-file 
created from a gnuplot file 
and embedded in this \LaTeX-file. 
%Note that the \texttt{gnuplot}-command is configurable 
%via the parameter \texttt{gnuplotCommand}, 
%but there will be hardly any command with the same command line interface 
%performing exactly the transformations given in Figure~\ref{fig:gp2pdf}, 
%except \texttt{gnuplot} itself. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F4_02gp2pdf.ptx}
}
\caption{\label{fig:gp2pdf}Conversion of a gnuplot-file 
into pdf-, eps- and ptx-files with inclusions}
\end{figure}

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F4_03someGnuplot.ptx}
}
\caption{\label{fig:gnuplot}
Converted sample gnuplot-file into ptx and pdf files }
\end{figure}


\section{Inclusion of Metapost files}\label{sec:metapost}

A graphic format, very native to TeX is \texttt{metapost}, 
a derivative of \texttt{metafont} originally used to describe shape of fonts. 
Although seemingly supported by \TeX{} only, 
\texttt{metapost} is interesting at its own, 
as it is a graphical programming language, 
Turing complete, much like postscript. 
Files containing \texttt{metapost} have the ending \texttt{.mp}. 
Note that there are other graphic formats 
like monochrome pictures in TIFF-format 
which are identified with the same extension 
but the metapost format has nothing to do with this. 

The interpreter for \texttt{metapost} 
is given by the parameter \texttt{metapostCommand} 
which defaults to \texttt{mpost}. 


Figure~\ref{fig:mp2mps} illustrates 
how \texttt{mpost} converts an \gls{mp}-file \texttt{xxx.mp} by default: 
%
\begin{itemize}
\item
into one or more \gls{mps}-files \texttt{xxx1.mps}\dots \texttt{xxxn.mps}, 
(as the mp-file may declare more than one figure) 
\item
creating a log-file \texttt{xxx.log} much like \LaTeX{} does 
\item
and an \gls{mpx}-file \texttt{xxx.mpx} containing the text of the figure. 
\end{itemize}

The mps-files look like postscript, or more like encapsulated postscript, 
but are not completely valid, since the prologue is missing, by default. 
Inserting the line ``\texttt{prologues\ :=\ 2;}'' % chktex 26
in the first line of the mp-file 
solves the problem as~\cite{MPost}, Section~14.2.1 explains. 
Then it can be viewed in ghostscript. 

A much better alternative is to specify the the option 


Roughly speaking, the mpx-file contains text parts of the mp-file; 
more knowledge is not necessary, as the texts are also in the mps-files 
and so the mpx-file is not used by this software. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F4_04mp2mps.ptx}
}
\caption{\label{fig:mp2mps}Conversion of a metapost-file into an mps-file}
\end{figure}


Figure~\ref{fig:metapost} gives an example of a metapost file 
included in this \LaTeX-file as ab mps-file 
created from the metapost file 
and embedded in this \LaTeX-file 
with the \cmd{includegraphics}-command. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\includegraphics{F4_05someMetapost1.mps}
}
\caption{\label{fig:metapost}
Converted sample metapost-file included as mps-file  }
\end{figure}

Note that \texttt{metapostCommand} may also besides \gls{eps} 
output \gls{svg} and \gls{png}, 
just by setting 
%
\begin{verbatim}
outputformat:="svg" 
\end{verbatim}
%
or that like 
(caution: case sensitive, assuming silently \texttt{eps} if not recognized). 
One would also adapt 
%
\begin{verbatim}
outputtemplate:="\%j\%c.svg"
\end{verbatim}
%
to control the names of the mps-files created. 
Here \texttt{\%j} represents the jobname and $\%c$ the number. 
One may well define alternatively 
%
\begin{verbatim}
outputtemplate:="\%j-\%c.svg"
\end{verbatim}

Finally we may set: 
%
\begin{verbatim}
prologues := 3;
\end{verbatim}

So the mp-file starts 
%
%\lstset{language=metapost, basicstyle=\normalsize}
\begin{lstlisting}[language=metapost, basicstyle=\normalsize]
outputformat:="svg";
outputtemplate:="\%j\%c.svg";
prologues := 3;
\end{lstlisting}

As an alternative, \texttt{mpost} compiler may be invoked with option 
%
\begin{verbatim}
-s<key>=<value>
\end{verbatim}
%
described in~\cite{MPost}, Appendix B.2.1. 
That way we can set internal variables with values 
overwriting those given by the mp-files. 
We recommend specification of internal variables through options 
if required globally. 

This would lead to invocation 
%
\begin{Verbatim}[fontsize=\scriptsize]
mpost -s 'outputformat="svg"' -s 'outputtemplate:="%j%c.svg"' -s prologues=3 file.mp
\end{Verbatim}

%FIXME\@: 
Note that the output 

\section{Inclusion of svg-files}\label{sec:picSvg}

Comparable with the xfig-format described in Section~\ref{sec:fig2dev} 
but much more elaborate and widely used is the \gls{svg}-format. 
There is a huge up-to-date official SVG 1.1 specification,~\cite{Svg11} 
and a specification for SVG Tiny 1.2, 
\cite{Svg12Tiny} which is itself quite short and more readable 
and gives also a good overview on ``SVG Big''. 
For a tutorial, see~\cite{SvgTut}. 
As stated in~\cite{Svg12Tiny}, Section~1.1, 
svg-files may contain vector graphics, raster images and text. 
It may also contain video and audio elements 
and may be interactive and dynamic, 
which goes beyond what can be included in \LaTeX-files. 

Figure~\ref{fig:svgWithText} shows a picture in \gls{svg}-format. 
As pdf-files are included directly 
via the \cmd{includegraphics}-command, 
using the \LaTeX-packages \pkg{xcolor} and \pkg{graphicx}, 
virtually, 
\texttt{xxx.svg} can be included directly via 
% FIXME\@: done differently 
\begin{lstlisting}[language=TeX]
%\includesvg[width=0.5\textwidth]{xxx}%
\end{lstlisting}
%
using the \LaTeX-packages \pkg{svg} described in~\cite{SvgP}. 
Note that the suffix of the file name shall be omitted. 

A closer look shows, that graphic preprocessing is done behind the scenes 
in the course of a \LaTeX-run 
creating files \texttt{xxx.pdf} and \texttt{xxx.pdf\_tex}. 
As described for fig-files in Section~\ref{sec:fig2dev} 
and for gnuplot-files in Section~\ref{sec:gnuplot2dev}: 
The latter is a \LaTeX-file containing text 
and including the former. 
To include \texttt{xxx.pdf} 
of course the \LaTeX-packages \pkg{xcolor} and \pkg{graphicx} 
are required. 
Moreover, it may happen that the \LaTeX-package \pkg{transparent} 
is required also, depending on the features used in\texttt{xxx.svg}. 

As indicated in~\cite{SvgP}, Section~1, 
the \pkg{svg}-package delegates the transformation 
of \texttt{xxx.svg} \texttt{xxx.pdf} and \texttt{xxx.pdf\_tex} 
to \texttt{inkscape}. 
This is a graphical editor with export functions 
which can be invoked in batch-mode also. 
Of course using the \pkg{svg}-package has the advantage 
that no explicit preprocessing is required, 
the created files updated by need. 
It is worth thinking about whether it is worthwhile 
writing according packages \texttt{fig} and \texttt{gnuplot}. 

On the other hand, 
this breaks the workflow this software normally applies to graphic files. 
In particular, the package creates latex main files 
which are not removed after the latex run 
if parametrized accordingly or if something goes wrong. 
Also, the \pkg{svg}-package does not provide the full flexibility 
of a standard solution. 
Since this software is still under construction 
and more than that, is in an experimental phase, 
we provide explicit preprocessing of svg-files using \texttt{inkscape}. 
Another problem with the \pkg{svg}-package is, 
that according to~\cite{SvgP}, Section~1, 
it does not work on windows platforms. 


Some research shows,
that \texttt{inkscape} in the version current at time of this writing
exports mixed pdf and latex: If invoked as 
%
\begin{Verbatim}[fontsize=\normalsize]
inkscape -D --export-filename=xxx.pdf --export-latex xxx.svg 
\end{Verbatim}
%
\texttt{inkscape} creates a file \texttt{xxx.pdf}
containing all graphics but text and another file \texttt{xxx.pdf\_tex}
containing text and including \texttt{xxx.pdf}.
The file \texttt{xxx.pdf\_tex}
can be be integrated into the latex document as
%
\begin{lstlisting}[language=TeX]
\def\svgwidth{0.5\textwidth}
\import{yyy}{xxx.pdf\_tex}%
\end{lstlisting}
%
Unlike \texttt{fig2dev} and \texttt{gnuplot}, 
specifying the files with their full path, 
has no effect, i.e.~inclusion uses the file name only. 
Thus \cmd{import}{} cannot be replaced by \cmd{input}{} 
and so the \LaTeX-package \pkg{import} is required. 
 

This is essentially the same technique as applied for fig-files 
and for gnuplot-files as described 
in Sections~\ref{sec:fig2dev}~and~\ref{sec:gnuplot2dev}. 

Analogously,
%
\begin{Verbatim}[fontsize=\normalsize]
inkscape -D --export-filename=xxx.eps --export-latex xxx.svg 
\end{Verbatim}
%
exports files \texttt{xxx.eps\_tex} and \texttt{xxx.eps}.

In older versions of \texttt{inkscape},
there was a configuration allowing \texttt{xxx.eps\_tex}
to include uniformly both \texttt{xxx.pdf} and \texttt{xxx.eps}.
Thus \texttt{xxx.pdf\_tex} could be deleted
and \texttt{xxx.eps\_tex} moved to \texttt{xxx.ptx}
which in turn could be included into the main document.

As shown in Figure~\ref{fig:svg2pdf},
for the current version of \texttt{inkscape},
this software filters \texttt{xxx.eps\_tex} into \texttt{xxx.ptx}
``manually'' so that both \texttt{xxx.pdf} and \texttt{xxx.eps}
are included in \texttt{xxx.ptx}.
Then it deletes the original files
\texttt{xxx.pdf\_tex} and \texttt{xxx.eps\_tex}.

The author has filed a bug report to the inkscape-team,
to avoid this workaround in future. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F4_06svg2pdf.ptx}%
}
\caption{\label{fig:svg2pdf}Conversion of an svg-file 
into pdf-, eps- and ptx-files with inclusions}
\end{figure}


\begin{figure}[htb]
\centering
%\def\svgwidth{0.5\textwidth}
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
  \import{}{F4_07someSvg.ptx}% this should be the standard
}
\caption{\label{fig:svgWithText}Some svg-picture with text FIXME\@: uniformity  }
\end{figure}


\section{Pictures which are not transformed}\label{sec:picasis}

Figure~\ref{fig:asIsJpg} shows some picture included as jpg. 
This is done as usual with the command \cmd{includegraphics}{}
provided by the package \pkg{graphicx}. 
According to the documentation~\cite{GraX}, page 13, 
the bounding box must be provided somehow. 
This may be done via the package \pkg{bmpsize} 
but also using the command \texttt{ebb}. 
FIXME\@: further research and further documentation is required. 

Note that both for \texttt{pdflatex} and siblings creating pdf-output 
and for \texttt{htlatex} in conjunction with \texttt{dvipdfmx} 
(see Section~\ref{sec:figpdf}) 
files in the format pdf, \gls{png}, \gls{jpg} are supported. 
 **** what about \gls{gif}? 
This list may be incomplete. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\setkeys{Gin}{width=0.9\textwidth}
\includegraphics%[width=0.9\textwidth]
{F4_08someJpgOboeBaroqueDennerMIR370}%.jpg
}
\caption{\label{fig:asIsJpg}Some jpg-picture, directly included }
\end{figure}

As an example, Figure~\ref{fig:asIsPng} shows the same picture 
as png-file. 

FIXME: at the moment, htlatex does not work with pictures at all. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\includegraphics[width=0.9\textwidth]{F4_09somePngOboeBaroqueDennerMIR370}%.png
}
\caption{\label{fig:asIsPng}Some png-picture, directly included }
\end{figure}



\chapter{Processing of \LaTeX{} main files}\label{chap:latexMainConversions}

Given graphics in formats includeable in tex-files, 
which may require preprocessing described in 
Chapter~\ref{chap:GraphConversions}, 
this section describes the conversions of latex main files 
into target files in detail. 
The most important target file formats is \gls{pdf}. 
Conversion in this format is described in Section~\ref{sec:tex2pdf}. 
Note that \gls{pdf} also occurs as source format 
for included pictures and as intermediate files. 
Specific for \LaTeX{} is the \gls{dvi} format, 
which is supported mainly for historical reasons. 
% FIXME\@: nowhere described. 

Almost independent of the format created, 
Inclusion of bibliographies, indices and glossaries 
requires additional conversions 
done by several auxiliary programs. 
Bibliographies are described in Section~\ref{sec:bibtex}, 
indices in Section~\ref{sec:indices} 
and glossaries in Section~\ref{sec:glossaries}. 
Sections~\ref{sec:rerunMakeIndexGlossaries} 
and~\ref{sec:rerunLatex} 
are special in that they describe rerunning several programs, 
which may be necessary even if certain lists are present 
like table of contents list of figures or list of tables. 


Besides the output formats traditional for \LaTeX, 
\gls{pdf} and \gls{dvi} describing e.g.~books, 
Section~\ref{sec:tex2html} describes creation of 
\gls{html}, Section~\ref{sec:tex2odt} the creation of \gls{odt} and 
Section~\ref{sec:tex2doc} creation of MS word formats like \gls{docx}. 
Finally, also pure text can be generated 
as described in Section~\ref{sec:tex2txt}. 

\newpage


\section{Transforming \LaTeX-files into pdf-files}\label{sec:tex2pdf}

The next step is to create a pdf-file from the tex-files. 
\LaTeX{} distinguishes master tex-files from tex-files intended to be inputted
from elsewhere. 
Not tanking comments and that like into account, master tex-files have the form 
%
%\lstset{language=tex, basicstyle=\small}
\begin{lstlisting}[language=tex, basicstyle=\small]
\RequirePackage[l2tabu, orthodox]{nag} % optional 
\documentclass{...}

\begin{document}
...
\end{document}
\end{lstlisting}

To satisfy this task,
one may apply a \LaTeX{} to pdf converter \texttt{latex2pdf} 
to a master tex-file \texttt{xxx.tex}. 
The \LaTeX-to-pdf converter \texttt{latex2pdf} 
is configurable via the parameter \texttt{latex2pdfCommand}. 
Possible values are \texttt{pdflatex}, \texttt{lualatex} and \texttt{xelatex}, 
where the first is the default for which this software is also tested. 
It is also possible to pass parameters to the \LaTeX{} to pdf converter. 

In fact, the converter \texttt{latex2pdf} 
does much more than converting tex to pdf. 
Figure~\ref{fig:tex2pdf} shows for \texttt{latex2pdf} set to \texttt{pdflatex}, 
that besides the pdf-file also a log-file and an aux-file is created. 
The log-file contains logging information on the run of the conversion 
and the aux-file transports information from one run to the next. 
Thus conversion goes without it but it is read if present. 
This is why it is depicted at input side in dashed lines. 

What is in fact in the aux-file depends on the package. 
Among other information, 
also citations and the location of the bibliography file with ending bib 
are present. 
This cannot be used directly in the next \texttt{latex2pdf} run 
to create the bibliography, 
because the entries must be retrieved from the bib-file, 
collected and sorted. 
This is done by invoking \texttt{bibtex} between two \texttt{latex2pdf} runs. 
Based on the aux-file, \texttt{bibtex} creates a bbl-file 
containing the bibliography, which is read in in the next \texttt{latex2pdf} run. 
For details see Section~\ref{sec:bibtex}. 

If an index is demanded, 
in addition \texttt{latex2pdf} creates an \gls{idx}-file. 
As the citations, it cannot be used directly to create an index in
the next \texttt{latex2pdf} run, 
because the index entries must be collected and sorted before. 
This is done by invoking \texttt{makeindex} 
between the two \texttt{latex2pdf} runs. 
Based on the idx-file, \texttt{makeindex} creates an \gls{ind}-file 
containing the index, which is read in in the next \texttt{latex2pdf} run. 
For details see Section~\ref{sec:indices}. 

If a glossary is demanded, this can be read off the \gls{aux}-file 
and a \gls{glo}-file is created. 
As the index, it cannot be used directly to create a glossary in
the next \texttt{latex2pdf} run, 
because the glossary entries must be collected and sorted before. 
This is done by invoking \texttt{makeglossaries} 
between the two \texttt{latex2pdf} runs. 
Based on the glo-file, \texttt{makeglossaries} creates a \gls{gls}-file 
containing the glossary, which is read in in the next \texttt{latex2pdf} run. 
For details see Section~\ref{sec:glossaries}. 

In addition, if
a table of contents, a list of figures, a list of tables or a list of listings is required, 
also a toc-file, a lof-file, a lot-file and a lol-file is created,
respectively, 
collecting the according information. 
If such a file is present, it is read in and is used
to create a table of contents, a list of figures, of tables and of listings 
in the second run of \texttt{latex2pdf}. 

To summarize, 
if a table of contents, a list of figures, a list of tables or 
a bibliography, an index or a glossary is present, 
a second \LaTeX{} run is required to make them appear in the pdf-output. 

If a table of contents and at the same time 
a bibliography, an index or a glossary is present, 
even two further \LaTeX{} runs are required: 
After the first one, the bibliography, the index or the glossary 
occurs in the pdf-file but not yet in the table of contents. 
This happens after the second additional \LaTeX{} run. 
As described in Sections~\ref{sec:rerunMakeIndexGlossaries} and 
\ref{sec:rerunLatex}, 
further runs of \texttt{makeindex}, resp,~\texttt{splitindex}, 
\texttt{makeglossaries} 
and of the \LaTeX-processor \texttt{latex2pdf} may be necessary. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_01tex2pdf.ptx}
}
\caption{\label{fig:tex2pdf}Conversion of a tex-file into a pdf-file 
(accordingly into a dvi-file)}
\end{figure}

\section{Bibliographies}\label{sec:bibtex}

In case the \LaTeX{} to pdf converter writes bibliographic information, 
into its aux-file, a bibliography must be generated. 
For each ocurrence of a \cmd{cite}-command in the tex-file, 
\texttt{latex2pdf} writes an according entry \cmd{citation}. 
Moreover, a \cmd{bibliography}-command in the tex-file 
writes a link to the bib-file containing the bibliography data 
into the aux-file as \cmd{bibdata}. 
Optionally, a \cmd{bibliographystyle}-command in the tex-file 
writes a link to the bibliography style file 
into the aux-file as \cmd{bibstyle}. 

To create a bibliography, 
a \texttt{bibtexCommand} must be run after the \LaTeX{} run. 
The default command is the traditional \texttt{bibtex} 
but there are more modern alternatives 
like \texttt{bibtexu} and \texttt{bibtex8} supporting utf8 encoding 
and others. 

% mention Biber and biblatex and also mlbibtex 

Essentially, \texttt{bibtex} extracts the citations in the aux-file, 
unifies them, i.e.~a citation is listed once even if it is used more than once, 
retrieves the according entries from the bib-file, sorts these, 
performs formatting and writes all into a bbl-file 
which can be included in the next run of \texttt{latex2pdf}. 

Note that after a \texttt{bibtex}-run, 
two \LaTeX{} runs are required: 
The first one just puts the bibliography found in the bbl-file 
into the pdf-file and the labels of the citations into the aux-file 
as \cmd{bibcite}-commands. 
The second run places the labels of the citations found in the aux-file 
at the citations given by \cmd{cite}. 
The package \pkg{tocbibind} described in~\cite{TocBibIndP}, 
then writes the headline of the bibliography into the table of contents. 
\index{table of contents}
The package \pkg{rerunfilecheck} described in~\cite{RerunFChkP}, 
ensures that \texttt{latex2pdf} is rerun if needed, 
provided loaded with option \texttt{aux}. 


This software presupposes, that \texttt{bibtex} reads the aux-file 
and creates a bbl-file and also an blg-file with logging output 
as illustrated by Figure~\ref{fig:aux2bbl}. 
From the blg-file this software may determine 
whether \texttt{bibtex} emitted an error or warnings. 


\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_02aux2bbl.ptx}
}
\caption{\label{fig:aux2bbl}
Conversion of an aux-file into a bbl-file using a bibliography}
\end{figure}

Vital information on \texttt{bibtex} can be found in~\cite{BibPat} 
and in~\cite{BibMar}. 
Also Chapter 10 in~\cite{Gra} gives vital information on \texttt{bibtex}. 


\section{Indices}\label{sec:indices}

In case the \LaTeX{} to pdf converter writes index information, 
into its idx-file, at least one index must be generated. 
Since the idx-file contains nothing but index information, 
an index is created if and only if the \gls{idx}-file is created. 
% Well, this is not really the truth: it is needed only if ...
Essentially, 
the command \cmd{makeindex}{} tells \texttt{latex2pdf} 
to open the idx-file for writing. 
Then for each occurrence of the \cmd{index}-command 
or similar (details see below) in the tex-file, 
an entry is written sequentially to the idx-file as 
\cmd{indexentry}{} comprising the keyword given by the \cmd{index}-command 
and the page number where the \cmd{index}-command occured. 
For example \cmd{index\{ant-task\}}{} creates an entry 
%
\begin{lstlisting}[language=TeX]
\indexentry{ant-task|hyperpage}{3}
\end{lstlisting}
%
in \texttt{xxx.idx}. 

Then the \texttt{makeindex}-command is applied to the idx-file 
which sorts keywords and for each keyword collects the according page numbers, 
sorts it and and writes the result into an \gls{ind}-file. 
In the next run of \texttt{latex2pdf}, 
the \cmd{prindindex}-command includes the index as a separate section; 
typically at the end of the pdf-file. 
The most basic package to provide this command 
is \pkg{makeidx} described in~\cite{MkidxShIdxP}. 
In addition, \pkg{makeidx} provides the command \cmd{see}{} 
which is for cross reference within an index. 
The package \pkg{tocbibind} described in~\cite{TocBibIndP}, 
then writes the headline of the index into the table of contents. 
\index{table of contents}
The package \pkg{rerunfilecheck} described in~\cite{RerunFChkP}, 
ensures that \texttt{latex2pdf} is rerun if needed, 
provided loaded with option \texttt{aux}. 

The same document,~\cite{MkidxShIdxP} 
also describes the package \pkg{showidx} 
which prints index entries at the margin of the document. 
This is for debugging only. 
\medskip


The main restriction of the package \pkg{makeidx} is, 
that only a single index can be created. 
The reason is that, \texttt{latex2pdf} creates a single idx-file 
and, as illustrated in Figure~\ref{fig:idx2ind}, 
\texttt{makeindex} creates a single ind-file from that, 
representing a single index. 

To overcome this restriction, 
replace package \pkg{makeidx} and \texttt{makeindex} 
with package \pkg{splitidx} and \texttt{splitindex} 
both described in \cite{SplitidxP}. 

The package \pkg{splitidx} is used 
in conjunction with the program \texttt{splitindex}. 
It must be possible to create a single index 
without using \pkg{splitidx} and \texttt{splitindex}. **** 

Package option \texttt{split} makes \texttt{latex2pdf} 
creating idx-files \texttt{xxx-y.idx} directly. 
Here \texttt{y} represents the identifier of an individual index. 
These idx-files can be transformed individually with \texttt{makeindex} 
into ind-files as illustrated in Figure~\ref{fig:idx2indMult}. 
Since \texttt{latex2pdf} can keep open only up to 16 output streams, 
not all of which can be used to create a file \texttt{xxx-y.idx}, 
this approach allows a limited number of indices 
and is thus not recommended and not supported. 
Another reason is, that this approach undermines 
the package \pkg{rerunfilecheck} described in~\cite{RerunFChkP}, 
and so it is not guaranteed that \texttt{latex2pdf} is rerun if needed. 
This explains why option \texttt{split} is not allowed. 
% **** check? 

Instead, without option \texttt{split}, 
\texttt{latex2pdf} creates a single idx-file. 
The program \texttt{splitindex} splits it up into several idx-files 
and applies \texttt{makeindex} to each of them separately 
as illustrated in Figure~\ref{fig:idx2indSplit}. 

For usage of further packages supporting multiple indices 
which are not intended to be used with this software, 
see Chapter~\ref{chap:gaps}. 

This software presupposes, that \texttt{makeindex} converts the idx-file 
into an ind-file containing the index 
and creating also an ilg-file with logging output 
as shown in Figure~\ref{fig:idx2ind}. 
From the ilg-file this software may determine 
whether \texttt{makeindex} emitted an error or warnings. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_03idx2ind.ptx}
}
\caption{\label{fig:idx2ind}Conversion of an idx-file into an ind-file}
\end{figure}

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_04idx2indMult.ptx}
}
\caption{\label{fig:idx2indMult}
Not supported: Conversion of idx-files into ind-files}
\end{figure}

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_05idx2indSplit.ptx}
}
\caption{\label{fig:idx2indSplit}Conversion of an idx-file into ind-files}
\end{figure}

It is possible to configure the makeindex-command 
and to pass arbitrary options. 
CAUTION\@: For the usual \texttt{makeindex}-command, 
the options \texttt{-o} specifying an output file 
and \texttt{-t} (transcript) specifying the logging file are not allowed, 
because this breaks the expectation to find the sorted index 
in file \texttt{xxx.ind} 
and bypasses the detection of errors and warnings of this software, 
respectively. 
Also specifying a style file via option \texttt{-s} 
is not recommended because this is used to create a glossary 
and so breaks glossary creation 
as described in Section~\ref{sec:glossaries}. 

Information on the makeindex program can be found in~\cite{MkIdxMoe} 
and in~\cite{MkIdxLam}. 
Also there is a site~\cite{MakeIdxOpts} 
describing all available options for \texttt{makeindex}. 

As indicated above, the program \texttt{splitindex} 
invokes \texttt{makeindex}. 
Its options are described in \cite{SplitidxP}, Section~3.10. 
Since the long option names are not understood in all environments, 
only the short options are recommended. 

Since \texttt{splitindex} must satisfy the interface 
given by Figure~\ref{fig:idx2indSplit}, 
the option \texttt{--help} and its shortcut \texttt{-h} are not allowed. 
Likewise for option \texttt{--version} and its shortcut \texttt{-V}. 
The option \texttt{--makeindex <makeindex>}, resp.~\texttt{-m <makeindex>}, 
is used with the \texttt{makeindex} command used for single indices. 
Thus this may not be given explicitly but is specified implicitly. 
Also, the option \texttt{--identify <regex>}, resp.~\texttt{-i <regex>} 
must be set implicitly because it must be the same expression 
as used to ***** 
Then splitindex.tlu is not allowed, 
because this has another expression. 

Only allowable seems \texttt{-V}, the short cut for \texttt{--verbose}. 

Then comes the name of the index file to be processed 
without suffix. 

The program \texttt{splitindex} invokes \texttt{makeindex}. 
The option option \texttt{--} coming after the filename, 
indicates that all following options are passed to \texttt{makeindex} 



\section{Glossaries}\label{sec:glossaries}

Creating glossaries 
requires the package \pkg{glossaries} described in~\cite{GloP}. 
Note that despite of the headline of this section, 
an despite \pkg{glossaries} itself supports multiple glossaries, 
this software supports only a single glossary 
and also sorting and unifying is done 
either via \texttt{makeindex} as for indices or via \texttt{xindy}, 
whereas the option to do without external programs 
offered also by package \pkg{glossaries} 
is not supported by this software. 

For generalizations see Chapter~\ref{chap:gaps}. 

As for creating indices there is a \LaTeX-command \cmd{makeindex}, 
to create a glossary there is a \LaTeX-command \cmd{makeglossaries}{} 
but the latter is not builtin as \cmd{makeindex} 
but provided by the package \pkg{glossaries}. 
If \texttt{xxx.tex} is the \LaTeX{} main file, 
\cmd{makeglossaries}{} opens the glo-file \texttt{xxx.glo} 
containing glossary entries for writing. 
As the builtin command \cmd{index}{} 
writes entries into the idx-file defining the index, 
the command \cmd{gls}{} defined by the package \pkg{glossaries} 
writes an entry into the glo-file. 
Note that \texttt{xxx.glo} typically contains entries more than once 
and that the entries are not sorted. 

To perform sorting, formatting and typically also unification, 
the package \pkg{glossaries} allows three mechanisms. 
This software supports two of them: 
via the shell command \texttt{makeindex}, which is also used for indices, 
and via the shell command \texttt{xindy}. 
Using \texttt{makeindex} is the default but can also be activated through 
\cmd{usepackage[makeindex]\{glossaries\}}. 
Using \texttt{xindy} instead of \texttt{makeindex} is triggered through 
\cmd{usepackage[xindy]\{glossaries\}}. 
Accordingly, for option \texttt{makeindex} the aux-file receives lines 
%
\begin{lstlisting}[language=TeX]
\providecommand\@istfilename[1]{}
\@istfilename{manualLatexMavenPlugin.ist}
\end{lstlisting}
%
whereas for option \texttt{xindy}, there are lines 
%
\begin{lstlisting}[language=TeX]
\providecommand\@istfilename[1]{}
\@istfilename{manualLatexMavenPlugin.xdy}
...
\providecommand\@xdylanguage[2]{}
\@xdylanguage{main}{english}
\providecommand\@gls@codepage[2]{}
\@gls@codepage{main}{}
\end{lstlisting}



This software neither invokes \texttt{makeindex} nor \texttt{xindy} directly. 
Instead it invokes the shell command \texttt{makeglossaries}
invoked without file ending  
which determines from the aux-file 
whether to invoke \texttt{makeindex} nor \texttt{xindy}. 
Accordingly, it writes the style definition 
by creating an ist-file \texttt{xxx.ist} or an xdy-file \texttt{xxx.xdy} 
if \texttt{makeindex} or \texttt{xindy} is specified as package option, 
respectively. 

Seemingly, \texttt{makeglossaries} relies on the aux-file 
to determine whether to invoke \texttt{makeindex} or \texttt{xindy} 
for sorting and unification. 
Then it invokes the according command and writes a log-file 
with ending \texttt{glg}, 
redirecting the logging output of \texttt{makeindex} or \texttt{xindy} 
adding own output so that a glg-file may be written, 
even if e.g.~\texttt{makeindex} is invoked and does not. 
In any case, if the glg-file is written, 
\texttt{makeglossaries} writes text matching 
%
\begin{verbatim}
(^\*\*\* unable to execute: )
\end{verbatim}
%
in the glg-file if an error occurs, 
no matter whether \texttt{makeindex} or \texttt{xindy} is invoked. 
Possibly, there are cases where an error causes no glg-file to be written. 
If no error occurs, a glg-file is written 
and if warnings are emitted, 
they either come from \texttt{makeindex} or from \texttt{xindy}. 
Thus warnings may be detected with the patterns 
defined by \texttt{makeindex} and by \texttt{xindy}. 

The style \texttt{list} (which is the default) is set in the form 
%
\begin{lstlisting}[language=TeX]
\usepackage[style=list]{glossaries}
\end{lstlisting}
%
where~\cite{GloP}, Section~15 lists predefined styles. 
So, the style determines the content of the style definition, 
whereas the options \texttt{makeindex} and \texttt{xindy} 
specify the form in which the style is encoded 
and thus the ending of the style file, 
which is either \texttt{ist} or \texttt{xdy}. 

Sorting the glo-file, as said above, 
currently is only supported using the command \texttt{makeglossaries}. 
The allowed options are essentially those 
making sense for \texttt{makeindex} and those making sense for \texttt{xindy}. 
If the shell command \texttt{makeglossaries} 
invokes \texttt{makeindex} of course only the according options 
are passed supplemented by additional options 
\texttt{-s}, \texttt{-t}, \texttt{-o}, to specify the
ist-file, the glg-file (the transcript-file) and the gls-file,
respectively, 
which is the result of sorting, the output file, 
and contains the entries of the glo-file 
just sorted, formatted and unified.
So for a tex main file \texttt{xxx.tex}
\texttt{makeglossaries} invokes
%
\begin{verbatim}
makeindex  -s "xxx.ist" -t "xxx.glg" -o "xxx.gls" "xxx.glo"
\end{verbatim}
%
Accordingly, if the shell command \texttt{makeglossaries} 
invokes \texttt{xindy} of course only the according options 
are passed supplemented by additional options 
\texttt{-M}, \texttt{-t}, \texttt{-o}. 
This is illustrated in Figure~\ref{fig:glo2gls}. 


\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_06glo2gls.ptx}
}
\caption{\label{fig:glo2gls}Conversion of a glo-file into a gls-file 
using \texttt{makeglossaries}}
\end{figure}


\section{Rerunning the index- and glossary processor}
\label{sec:rerunMakeIndexGlossaries}

As described in Section~\ref{sec:tex2pdf}, 
running a \LaTeX-to-pdf converter as \texttt{latex2pdf} 
may detect the presence of a bibliography, an index and/or of a glossary 
and writes raw files to describe them. 
After that, an intermediate step is required, 
sorting, unifying and formatting the entries. 
This is always done by an external program. 

In the next step the \LaTeX{} processor must read in the unified entries again. 
Whereas a \LaTeX-run does not affect the bibliography, 
it may well invalidate the page numbers 
of the entries of the index or of the glossary. 
Thus the sorted index and glossary must be rebuild 
before the next \LaTeX{} run makes them visible in the pdf-file. 

To that end, we use the package \pkg{rerunfilecheck}. 
%
\begin{lstlisting}[language=TeX]
\usepackage[index, glossary]{rerunfilecheck}
\end{lstlisting}
%
must be put before 
%
\begin{lstlisting}[language=TeX]
\usepackage{makeidx}
\makeindex
\usepackage[toc, xindy]{glossaries}
%, xindy or even [xindy={language=english,codepage=utf8}]
% mainly for index and glossaries 
\makeglossaries
\end{lstlisting}
%
in particular before \cmd{makeindex}{} and \cmd{makeglossaries}. 

Note that the package \pkg{hyperref} already loads \pkg{rerunfilecheck} 
but with the wrong options. 
Thus the above declaration must come before 
%
\begin{lstlisting}[language=TeX]
\usepackage[...]{hyperref}
\end{lstlisting}
%
to avoid error 
%
\begin{verbatim}
Option clash for package rerunfilecheck
\end{verbatim}


Package \pkg{rerunfilecheck} detects almost safely 
changes of the raw index file writing an according message 
into the log-file. 
That way, it can be determined whether it is necessary 
to rerun \texttt{makeindex} and \texttt{makeglossaries}. 
After that, of course \LaTeX{} must be rerun at least once. 
Note that Section~\ref{sec:rerunLatex} describes 
when to rerun \LaTeX{} without prior running *****

\section{Rerunning the \LaTeX{} processor}\label{sec:rerunLatex}

FIXME\@: a word on change in toc, lof, lot and lol. 

As indicated in the previous sections, 
\texttt{latex2pdf} must be rerun, 
if \texttt{bibtex} or \texttt{makeindex} \texttt{splitindex} 
or \texttt{makeglossaries} 
had been run 
to read in the bibliography created by \texttt{bibtex} 
or the index created by \texttt{makeindex} 
or the glossary created by \texttt{makeglossaries}. 
Likewise, if a toc-file, a lof-file, a lot-file or a lol-file
had been created in the first \texttt{latex2pdf} run, 
another run is needed to read in these files 
to create a table of contents, a list of figures or a list of tables, 
respectively. 
Note that for all these cases, 
the log-file does not allow to detect that \texttt{latex2pdf} has to be rerun, 
by matching a fixed pattern. 

After the second run of \texttt{latex2pdf}, 
the table of contents,
the list of figures, the list of tables and the list of listings 
are included and a section with the bibliography, 
the index and the glossary are inserted. 
It takes a third run of \texttt{latex2pdf} 
to include the bibliography the index and the glossary 
into the table of contents. 
Also it takes that third run to replace the citations 
with the proper labels given in the bibliography. 

Inserting the table of contents,
the list of figures, the list of tables and the list of listings 
may shift the subsequent text 
which may require another run of \texttt{latex2pdf} 
to get the page numbers right. 
As described in Section~\ref{sec:rerunMakeIndexGlossaries} 
intermediate runs of \texttt{makeindex} and \texttt{makeglossaries} 
may be required 
and these also require another run of \texttt{latex2pdf} 
also to get the page numbers right. 
The package \pkg{rerunfilecheck} allows to detect this need to rerun 
by pattern matching on the log-file almost for sure: 
Still there is some chance 
that the lengths and the md5-sum of all relevant files 
remain the same, although there is a relevant change. 
In this case, this software fails to update 
triggering another \texttt{latex2pdf} run. 


Note that there are several packages which require additional runs, 
such as the longtable-package, 
which may vary dimensions of tables. 
This software presupposes, that all these reruns 
may be detected by matching a fixed pattern in the log-file. 
Since packages are frequently changed and new packages are written, 
also the pattern cannot be fixed. 
Thus it is configurable. 

Note that, if a package requires running other programs 
between two runs of \texttt{latex2pdf}, 
this would require a change in this software. 


\section{Creating hypertext}\label{sec:tex2html}

To create html and xhtml from \LaTeX-files, 
a \texttt{tex4htCommand}-command is used 
Together with its parameters, 
it is described in Section!\ref{sec:settingsLatex2Html}. 
This may be \texttt{htlatex}, the default based on \texttt{latex} 
and \texttt{htxelatex} based on \texttt{xelatex}. 

Figure~\ref{fig:tex2xml} shows the steps \texttt{htlatex} performs: 
From the input \LaTeX-file \texttt{xxx.tex} 
another \LaTeX-file \texttt{yyy.tex} is created 
which arises from \texttt{xxx.tex} by adding 
%FIXME\@: maybe instead: \RequirePackage which may be placed before documentclass
\begin{lstlisting}[language=TeX]
\usepackage[...]{tex4ht}. 
\end{lstlisting}
%
Then \texttt{htlatex} runs \texttt{latex} on \texttt{yyy.tex} 
which results in \texttt{yyy.dvi}. 
Note that this is in contrast to \texttt{pdflatex} 
which would create some \texttt{yyy.pdf} unless otherwise specified. 

Then comes the converter \pkg{tex4ht} into the game 
which creates several html-files among those also \texttt{xxx.html}. 
The other files, \texttt{yyy.idv} and \texttt{yyy.lg}, 
are further processed by \texttt{t4ht} 
creating the stylesheet \texttt{xxx.css} and graphic files. 
\medskip


Let us make this more precise. 
The output of latex is a standard \gls{dvi}-file 
interleaved with special instructions 
for the post-processor \pkg{tex4ht} to use. 
Note that \pkg{tex4ht} is the name both of the post-processor 
and of the \LaTeX-package. 
The special instructions come from implicit and explicit requests 
made in the source file through commands for TeX4ht. 

The utility \pkg{tex4ht} translates the dvi-code into standard text, 
while obeying the requests it gets from the special instructions. 
The special instructions may request the creation of files, 
insertion of html code, filtering of pictures, and so forth. 
In the extreme case that the source code contains no commands of TeX4ht, 
\pkg{tex4ht} gets pure dvi-code and it outputs (almost) plain text 
with no hypertext elements in it.

The special (\cmd{special}) 
instructions seeded in the dvi-code 
are not understood by dvi processors other than those of TeX4ht.

\texttt{t4ht}
This is an interpreter 
for executing the requests made in the \texttt{xxx.lg} script.

\texttt{xxx.idv}
This is a dvi-file extracted from \texttt{xxx.dvi}, 
and it contains the pictures needed in the html files.

\texttt{xxx.lg}
This is a log file listing the pictures of \texttt{xxx.idv}, 
the \gls{png} files that should be created, CSS information, 
and user directives introduced 
through the ``\cmd{Needs\{\ldots\}}'' command.

\raggedbottom



\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_07tex2xml.ptx}
}
\caption{\label{fig:tex2xml}Conversion of a tex-file into an xml-file}
\end{figure}

\begin{Verbatim}[fontsize=\tiny]
(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/tex4ht.4ht
version 2009-01-07-07:11
--------------------------------------
Note --- for additional information, use the command line option `info'
--------------------------------------

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht

Note: to remove the <?xml version=...?> processing instruction 
use the command line option `no-VERSION'

Note: to remove the DOCTYPE declaration 
use the command line option `no-DOCTYPE'
)

--------------------------------------
Note: for marking of the base font, use the command line option `fonts+'
Note: for non active _, use the command line option `no_'
Note: for _ of catcode 13, use the command line option `_13'
Note: for non active ^, use the command line option `no^'
Note: for ^ of catcode 13, use the command line option `^13'
--------------------------------------

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht
--------------------------------------
Note: For section filenames that reflect on their titles 
use the command line option `sec-filename'

Note: for alternative charset, use the command line option `charset=...'

Note: to ignore CSS font decoration, use the `NoFonts' command line option

Note: for jpg bitmaps of pictures, 
use the `jpg' command line option. 
(Character bitmaps are controled only by `g' 
records of tex4ht.env and `-g' switches of tex4ht.c) 

Note: for gif bitmaps of pictures, use the `gif' command line option. 
(Character bitmaps are controled only by `g' 
records of tex4ht.env and `-g' switches of tex4ht.c) 

Note: for content and toc in 2 frames, 
use the command line option `frames'

Note: for content, toc, and footnotes in 3 frames, 
use the command line option `frames-fn'

Note --- for file extension name xht, use the command line option `xht'
--------------------------------------
TeX4ht package options: xhtml,uni-html4,2,pic-tabular,html
--------------------------------------
Note: to ignore CSS code, use the command line option `-css

Note: for inline CSS code, use the command line option `css-in'

Note: for pop ups on mouse over, use the command line option `mouseover'

Note: for addressing images in a subdirectory, 
use the command line option `imgdir:.../'
)

Note --- for back links to toc, use the command line option `sections+'

Note --- for linear crosslinks of pages, use the command line option `next'

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/latex.4ht
version 2009-05-21-09:32
--------------------------------------
Note --- for links into captions, instead of float heads, use the command l
ine option `refcaption'
--------------------------------------

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht
--------------------------------------
Note --- For mini tocs immediately aftter the header 
use the command line option `minitoc<'

Note --- for enumerated list elements with valued data, 
use the command line option `enumerate+'

Note --- for enumerated list elements li's with value attributes, use the c
ommand line option `enumerate-'

Note --- for CSS2 code, use the command line option `css2'

Note --- for bitmap fbox'es, use the command line option `pic-fbox'

Note --- for bitmap framebox'es, use the command line option `pic-framebox'

Note --- for inline footnotes use command line option `fn-in'

Note --- for tracing of latex font commands, 
use the command line option `fonts'
--------------------------------------
--------------------------------------
Note --- for width specifications of tabular p entries, 
use the `p-width' command line option 
or a configuration similar to 
\Configure{HColWidth}{\HCode{style="width:\HColWidth"}}
--------------------------------------
)
(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4-math.4ht
version 2009-05-18-23:01
--------------------------------------
Note --- for pictorial eqnarray, use the command line option `pic-eqnarray'

Note --- for pictorial array, use the command line option `pic-array'

Note --- for pictorial $...$ environments, 
use the command line option `pic-m' (not recommended!!)

Note --- for pictorial $...$ and $$...$$ environments with latex alt, 
use the command line option `pic-m+' (not safe!!)

Note --- for pictorial array, use the command line option `pic-array'
)
(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/unicode.4ht
version 2010-12-18-17:40
)
(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4-uni.4ht))


(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht
--------------------------------------
Note --- for tocs without * entries, use command line option `notoc*'

Note --- for tocs without * entries, use command line option `notoc*'

Note --- to eliminate mini tables of contents, 
use the command line option `nominitoc'

Note --- for frames-like object-based table of contents, 
use the command line option `obj-toc'

Note --- for files named derived from section titles, 
use the command line option `sec-filename'

Note --- for i-columns index, 
use the command line option `index=i' (e.g., index=2)
--------------------------------------
)

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht

Note --- if included graphics are of degraded quality, 
try the command line options `graphics-num' or `graphics-'. 
The `num' should provide the density of pixels in the bitmaps (e.g., 110). 

Note --- for key dimensions try the option `Gin-dim'; 
for key dimensions when bounding box is unavailable 
try `Gin-dim+'; neither is recommended
)

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht
Note --- for URL encoding within href use the command line option `url-enc'
)

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht

Note --- for pictorial longtable, 
use the command line option `pic-longtable'
)

(/usr/local/texlive/2014/texmf-dist/tex/generic/tex4ht/html4.4ht

Note --- to ensure proper alignments use fixed size fonts (see listings.dtx
)
)
\end{Verbatim}

\pkg{tex4ht} yields 

\begin{Verbatim}[fontsize=\scriptsize]
----------------------------
tex4ht.c (2012-07-25-19:36 kpathsea)
tex4ht 
--- error --- improper command line
tex4ht [-f<path-separator-ch>]in-file[.dvi]
   [-.<ext>]            replacement to default file extension name .dvi
   [-c<tag name>]       choose named segment in env file
   [-e<env-file>]
   [-f<path-separator-ch>]        remove path from the file name
   [-F<ch-code>]        replacement for missing font characters; 0--255; default 0
   [-g<bitmap-file-ext>]
   [-h(e|f|F|g|s|v|V)]  trace: e-errors/warnings, f-htf, F-htf search
                            g-groups, s-specials, v-env, V-env search
   [-i<htf-font-dir>]
   [-l<bookkeeping-file>]
   [-P(*|<filter>)]     permission for system calls: *-always, filter
   [-S<image-script>]
   [-s<css-file-ext>]   default: -s4cs; multiple entries allowed
   [-t<tfm-font-dir>]
   [-u10]               base 10 for unicode characters
   [-utf8]              utf-8 encoding for unicode characters
   [-v<idv version>]    replacement for the given dvi version
   [-xs]           ms-dos file names for automatically generated gifs
\end{Verbatim}


\texttt{t4ht} yields 

\begin{Verbatim}[fontsize=\footnotesize]
--------------------------------------------------------------------
t4ht [-f<dir char>]filename ...
  -b     ignore -d -m -M for bitmaps
  -c...  choose named segment in env file
  -d...  directory for output files       (default:  current)
  -e...  location of tex4ht.env
  -i     debugging info
  -g     ignore errors in system calls
  -m...  chmod ... of new output files (reused bitmaps excluded)
  -p     don't convert pictures           (default:  convert)
  -r     replace bitmaps of all glyphs    (default:  reuse old ones)
  -M...  chmod ... of all output files
  -Q     quit, if tex4ht.c had problems
  -S...  permission for system calls: *-always, filter
  -X...  content for field %%3 in X scripts
  -....  content for field %%2 in . scripts

Example: 
   t4ht name -d/WWW/temp/ -etex4ht-32.env -m644
--------------------------------------------------------------------
\end{Verbatim}

\flushbottom

\section{Creating odt-files}\label{sec:tex2odt}

\section{Creating MS word files}\label{sec:tex2doc}

The best way to convert \LaTeX-files into MS word files is via odt files. 
Conversion from \LaTeX{} to odt 
is already described in Section~\ref{sec:tex2odt}. 
The last step can be done by \texttt{odt2doc} which can create both 
doc-format and docx-format and many others 
which is illustrated in Figure~\ref{fig:tex2doc}. 


\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_08tex2doc.ptx}
}
\caption{\label{fig:tex2doc}Conversion of a tex-file into a docx-file}
\end{figure}



\section{Creating plain text files}\label{sec:tex2txt}

Why should one create plain text from \LaTeX-files? 
Maybe this is the minimal format the receiver can work with. 
Another common application is word-count, 
in particular if writing a paper for a journal. 

Plain text files can be created from \LaTeX-files 
just by stripping off the tex-commands. 
The disadvantage is, 
that references, bibliography, index, glossary, 
table of contents, list of figures, list of tables, \dots 
and symbols get lost. 
Thus, the first step we take is complete creation of a pdf-file 
except display of warnings like bad boxes 
as described in Section~\ref{sec:tex2pdf}. 
This creates an appropriate pdf-file, 
with correct numberings and links, 
possibly with overfull boxes and that like. 
As a final step, we convert the pdf-file into a text file 
using, as a default \texttt{pdftotext} with ending \texttt{txt}. 
Figure~\ref{fig:tex2txt} illustrates the translation process. 

\begin{figure}[htb]
\centering
\ifthenelse{\boolean{texFhtLoaded}}{
should be a picture 
}{
\import{}{F5_09tex2txt.ptx}
}
\caption{\label{fig:tex2txt}Conversion of a tex-file into an txt-file}
\end{figure}

Note that \texttt{pdftotext} produces a text file with page numbers 
and signifies the end of a page 
(to see how, just have a look at the end of the file), 
so that one can identify page numbers as such. 
Thus references, index, glossary, table of contents and that like 
referring to page numbers carry valuable information. 
Also symbols available in utf8 encoding are preserved. 
In contrast, heavily stacked formulae become unreadable, 
because \texttt{pdftotext} displays them line by line 
and drops fraction bars completely. 
Also formulae with complex subformulae in a root operator  
become unreadable because the root operator becomes just a root symbol. 
Likewise for integrals and that like. 

Aspects of figures kept are the captions of course but also the \LaTeX-texts. 
This is displayed line-wise. 
What gets lost is the postscript/pdf-parts, i.e.~the plain graphics. 

\raggedbottom


\chapter{Parameters resp. Settings}\label{chap:settings}

This section describes the parameters 
of both the ant-task and the maven-plugin. 
The parameters are listed 
in Tables~\ref{tab:paramGen}~through~\ref{tab:paramExt} 
with names, default values and short explanations. 
Note that neither of the parameters is mandatory, 
as there are always valid default values. 

Each of the tables is described in a separate section. 
Table~\ref{tab:paramGen} 
shows parameter controlling the general conversion process 
described in detail in Section~\ref{sec:settingsGen}. 
These are directories with names \texttt{xxxDirectory} 
and further parameters not following a naming convention. 
The other tables show parameters after a certain naming scheme: 
Command names have the form \texttt{xxxCommand} 
and the parameter with the according options have the form \texttt{xxxOptions}. 
Here \texttt{xxx} represents a certain converter. 
This is one of 
%
\begin{itemize}
\item[fig2dev]
The converter of fig-files into mixed latex- and pdf-files. 
\item[gnuplot]
The converter of gnuplot-files into mixed latex- and pdf-files. 
\item[metapost]
The converter of metapost-files into mixed latex- and pdf-files.
\item[latex2pdf]
The converter of latex-files into pdf-files. 
\item[bibtex]
The creator of a bibliography from an aux-file.
\item[MakeIndex]
The makeindex utility creating an index. 
\item[MakeGlossaries]
The makeglossaries utility creating a glossary. 
\item[tex4ht]
The converter of latex into html and also into odt, 
depending on the parameters. 
\item[latex2rtf]
The converter of latex-files into rtf-files. 
\item[odt2doc]
The converter of odt-files into doc(x)-files. % chktex 36
\item[pdf2txt]
The converter of pdf-files into txt-files. 
\item[chktex]
A code-checker converting in a sense a latex main file into a log-file 
containing errors, warnings and further messages. 
\end{itemize}

It is a little more complicated 
with the parameters in Section~\ref{sec:settingsLatex2Html}. 

There are some parameters of the form \texttt{patternXxxYyy}, 
referring to a pattern in the log-file of the converter \texttt{Xxx} 
indicating an event \texttt{Yyy} which is one of the following: 
%
\begin{itemize}
\item[ReRun]
indicates that \texttt{Xxx} needs to be rerun.
\item[Err]
indicates that \texttt{Xxx} had an error. 
\item[Warn]
indicates that \texttt{Xxx} had a warning. 
\end{itemize}

Essentially, there are two kinds of parameters: 
Most are just passed to the converters invoked by this software. 
The parameters of this software 
are so that the choice of the converter, i.e.~the name of the application 
can be configured 
and also each converter can be almost freely configured. 

Parameters not passed to an application, 
are either really crucial 
or are included to allow also development of latex files. 


\section{General Parameters}\label{sec:settingsGen}

This section describes the parameters of Table~\ref{tab:paramGen}. 
%TODO\@: do this. 

\begin{longtable}{|ll|}
\toprule
Parameter        & Default  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:paramGen} General parameters}
\endlastfoot%
\texttt{texSrcDirectory}  & \texttt {src/site/tex}  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The latex source directory as a string 
relative to \texttt{\$baseDirectory}, 
containing \texttt{\$texSrcProcDirectory}. 
This directory determines also the sub-directory of 
\texttt{\$outputDirectory} to lay down the generated artifacts. 
The default value is ``\texttt{src/site/tex}'' on Unix systems. 
\end{minipage}
} \\
\texttt{texSrcProcDirectory}  & \texttt {.}  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The latex source processing directory as a string 
relative to \texttt{\$texSrcDirectory}
containing all tex main documents 
and the graphic files to be processed 
and also to be cleaned. 
Whether this is done recursively in sub-folders 
is specified by \texttt{\$readTexSrcProcDirRec}. 
The default value is ``\texttt{.}''. 
\end{minipage}
} \\
\texttt{readTexSrcProcDirRec}  & \texttt{true}  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Whether the tex source directory \texttt{\$texSrcProcDirectory} 
shall be read recursively, 
i.e.~including the sub-directories recursively. 
This is set to \texttt{false} only during information development. 
%The default value is 'true'.
\end{minipage}
} \\
\texttt{outputDirectory}  & \texttt{.}             \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The generated artifacts will be copied to \texttt{outputDirectory}
relative to \texttt{\$targetSiteDirectory} 
which is by default '\texttt{\$targetDirectory/site}' on Unix systems. 
%The default value is '\texttt{.}'.  
\end{minipage}
} \\
\texttt{targets}          & \texttt{pdf, html}     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
A comma separated list of targets to be stored in \texttt{\$targetSet}. 
%The default value is '\texttt{pdf, html}'. 
\end{minipage}
} \\
\texttt{convertersExcluded}          & empty     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
A comma separated list of excluded {@link Converter}s 
given by their command. 
Excluded converters need not be installed but their names must be known. 
They don't show up in the version check of target 'vrs' 
and of course they are not allowed to be used. 
% By default, this list is empty. 
\end{minipage}
} \\
\texttt{patternLatexMainFile} & see Section~\ref{subsec:patternLatexMainFile}\\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern to be applied to the contents of tex-files 
which identifies a \LaTeX{} main file. 
Here we assume that the latex main file should contain 
the declaration ``\cmd{documentclass}'' 
or the old fashioned ``\cmd{documentstyle}'' 
preceded by a few constructs. 
Strictly speaking, this is not necessary. 
For a more thorough discussion, 
and for an alternative approach, consult the manual. 

The default value is chosen to match quite exactly 
the latex main files, no more no less. 
Since the pattern is chosen 
according to documentation collected from the internet, 
one can never be sure whether the pattern is perfect. 

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the deficiency. 
\end{minipage}
} \\
\texttt{texPath}          &  empty string        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Path to the TeX scripts or null. 
In the latter case, the scripts must be on the system path. 
Note that in the pom, \texttt{$<$texPath/$>$} 
and even \texttt{$<$texPath$>$\ \ \ \ $<$/texPath$>$} represent the null-File. 
The default value is null.
\end{minipage}
} \\
\texttt{cleanUp}             & \texttt{true}             \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Clean up the working directory in the end? 
May be used for debugging when setting \texttt{false}. 
%The default value is '\texttt{true}'. 
\end{minipage}
} \\
\texttt{patternCreatedFromLatexMain} & 
see Section~\ref{subsec:patternCreatedFromLatexMain} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
This pattern is applied to file names 
and matching shall accept all the files 
which were created from a latex main file `\texttt{xxx.tex}'. 
It is neither applied to directories 
nor to `\texttt{xxx.tex}' itself. 
It shall not comprise neither graphic files to be processed 
nor files created from those graphic files. 

This pattern is applied 
in the course of processing graphic files 
to decide which graphic files should be processed 
(those rejected by this pattern) 
and to log warnings if there is a risk, 
that graphic files to be processed 
are skipped or that processing a latex main file overwrites 
the result of graphic preprocessing. 

When clearing the tex source processing directory 
\texttt{\$texSrcProcDirectory}, 
i.e.~all generated files should be removed, 
first those created from latex main files. 
As an approximation, 
those are removed which match this pattern. 

The sequence `\texttt{T\$T}' 
is replaced by the prefix `\texttt{xxx}'. 
The sequence `\texttt{T\$T}' must always be replaced: 
The symbol `\texttt{\$}' occurs as end-sign as `\texttt{)\$}' % chktex 9
or as literal symbol as `\texttt{\$}'. 
Thus `\texttt{T\$T}' is no regular occurrence 
and must always be replaced with `\texttt{xxx}'. 
		 
Spaces and newlines are removed 
from that pattern before matching. 

This pattern may never be ensured to be complete, 
because any package 
may create files with names matching its own patterns 
and so any new package may break completeness. 
Nevertheless, the default value aims completeness 
while be tight enough not to match names of files not created. 

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the deficiency. 
\end{minipage}
} \\ % chktex 10 (bug) 
\end{longtable}


\subsection{The parameter \texttt{patternLatexMainFile}}
\label{subsec:patternLatexMainFile}

The default pattern for identifying a \LaTeX{} main file is 
%
\begin{Verbatim}[fontsize=\footnotesize]
\A(\\RequirePackage\s*(\[(\s|\w|,)*\])?\s*\{\w+\}\s*(\[(\d|\.)+\])?|
\\PassOptionsToPackage\s*\{\w+\}\s*\{\w+\}|
%.*$|
\\input\{[^{}]*\}|
\s*)*
\\(documentstyle|documentclass)
\end{Verbatim}
%
This means that the latex main file is the one 
containing \cmd{documentclass}{} for modern classes 
and \cmd{documentstyle}{} for old fashioned ones. 
This may be preceded only by 
%
\begin{itemize}
\item
the command \cmd{RequirePackage}, 
\item
the command \cmd{PassOptionsToPackage}, 
\item
by comment lines, 
\item
by \cmd{input}, and 
\item
by space. 
\end{itemize}
%
Note that \cmd{A}{} represents the beginning of the stream. 

Strictly speaking, also \cmd{(re)newcommands} % chktex 36
and other constructs are possible but not allowed here. 
Strictly speaking also \cmd{documentclass}{} is not required, 
it could be hidden in some \cmd{input}-file. 
If we stick to the wise convention to open and close the same environment 
in the same file and to have \cmd{documentclass}, 
\cmd{begin\{document\}}{} and \cmd{end\{document\}}{} 
in the same file also, 
then a latex main file without \cmd{documentclass}{} 
cannot contain very much material. 

So we ask the user to have \cmd{documentclass}{} 
declared in the latex main file. 

For users of Emacs with package auctex, there is a valuable alternative: 

Latex main files are marked with an end section as this file: 
%
\begin{Verbatim}[fontsize=\footnotesize]
%%% Local Variables: 
%%% mode: latex
%%% TeX-command-extra-options: "-src-specials -recorder -shell-escape" 
%%% TeX-master: t
%%% End: 
\end{Verbatim}
% 
The vital line in this context is \texttt{\%\%\% TeX-master: t}. 
In contrast to this, a non-master file 
either has no end-section at all or has an end section 
declaring the according master file (if it is unique) 
explicitly as the following one from \texttt{header.tex}: 
%
\begin{verbatim}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "manualLatexMavenPlugin"
%%% End:
\end{verbatim}

So a pattern for latex main files could also be 
%
\begin{verbatim}
^%%% Local Variables: $
^%%% TeX-master: t$
^%%% End: ^
\s*
\end{verbatim}
%
The problem is only in case of exchange of the source 
with a developer which does not use Emacs/auctex. 


\subsection{The parameter \texttt{patternCreatedFromLatexMain}}
\label{subsec:patternCreatedFromLatexMain}

The files created from a latex main file 
depend strongly on the compiler options 
and on packages used in the latex main file 
and in the tex files inputted. 
The default value 
`\texttt{\^{}T\$T\textbackslash.$[$\^{}.$]*$}' 
is appropriate for most parameters and packages: 
most packages create files with names only 
which coincide with the name of the latex main file, except the suffix. 
This is all sufficient even for programs doing postprocessing 
such as \texttt{bibtex}, \texttt{makeindex}, \texttt{xindy} and 
\texttt{makeglossaries}. 
The only exception is \texttt{splitindex} 
which requires in addition 
`\texttt{\^{}T\$T\textbackslash-.+\.(idx|ind|ilg)}'. 

Package `\pkg{srcltx}' requires in addition 
`\texttt{\^{}T\$T\textbackslash.synctex\textbackslash.gz}' 
and finally package `\pkg{tex4ht}' is for all the rest. 
The pattern is designed 
to match quite exactly the created files, 
not much more and at any case not less. 
In particular it has to comprise the files matching pattern 
\texttt{\$patternT4htOutputFiles}. 
Nevertheless, since any new package may break the pattern, 
and not every package is well documented, 
this pattern cannot be guaranteed to be final. 

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the deficiency. 

The default value for this pattern is currently: 
%
\begin{verbatim}
^(
T$T             (\.([^.]*|synctex\.gz|out\.ps)|
   (-|ch|se|su|ap|li)?\d+\.x?html?|
             \d+x\.x?bb|
             \d+x?\.png|
             -\d+\.svg)|
zzT$T\.e?ps|
(cmsy)\d+(-c)?-\d+c?\.png|
(pdf)?latex\d+\.fls)$
\end{verbatim}


\section{Parameters for graphical preprocessing}\label{sec:settingsGraph}

This section describes the parameters for graphical preprocessing 
given in Table~\ref{tab:paramGraphics}. 

TODO\@: do this. 


\begin{longtable}{|ll|}
\toprule
Parameter        & Default  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:paramGraphics} Parameters for graphics preprocessing}
\endlastfoot%
\texttt{fig2devCommand}   & \texttt{fig2dev}\index{fig2dev}     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The fig2dev command for conversion of fig-files into various formats. 
Currently only \texttt{pdf} combined with \texttt{ptx} is supported. 
%The default value is '\texttt{fig2dev}'. 
\end{minipage}
} \\
\texttt{fig2devGenOptions}   & empty     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the command \texttt{\$fig2devCommand} 
common to both output languages. 
For the options specific for the two output languages 
`\texttt{pdftex}' and `\texttt{pdftex\_t}', 
see the explanation of the parameters 
\texttt{\$fig2devPtxOptions} and \texttt{\$fig2devPdfEpsOptions}, 
respectively. 
% The default value is the empty string. 
\end{minipage}
} \\
\texttt{fig2devPtxOptions}   & empty     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the command \texttt{\$fig2devCommand} 
specific for the output language `\texttt{pdftex\_t}'. 
Note that in addition to these options, 
the option `\texttt{-L pdftex\_t}' specifies the language, 
\texttt{\$fig2devGenOptions} specifies the options 
common for the two output languages 
`\texttt{pdftex}' and `\texttt{pdftex\_t}' 
and `\texttt{-p xxx.pdf}' specifies the pdf-file to be included. 
% The default value for this option is the empty string. 
\end{minipage}
} \\
\texttt{fig2devPdfEpsOptions}   & empty     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the command \texttt{\$fig2devCommand} 
specific for the output language `\texttt{pdftex}'. 
Note that in addition to these option1s, 
the option `\texttt{-L pdftex}' specifies the language and 
\texttt{\$fig2devGenOptions} specifies the options 
common for the two output languages 
`\texttt{pdftex}' and `\texttt{pdftex\_t}'. 
% The default value for this option is the empty string. 
\end{minipage}
} \\
\midrule
\texttt{gnuplotCommand}   & \texttt{gnuplot}\index{gnuplot}     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The command for conversion of gnuplot-files 
into various formats. 
Currently only pdf (graphics) 
combined with pdf\_t (latex-texts) is supported. 
% The default value is 'gnuplot'. 
\end{minipage}
} \\
\texttt{gnuplotOptions}   & empty    \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options specific for \texttt{\$gnuplotCommand}'s 
output terminal ``cairolatex'', 
used for mixed latex/pdf-creation. 
Note that the option `\texttt{pdf|eps}' 
of the terminal `\texttt{cairolatex}' is not available, 
because it is set internally. 
% The default option string is empty. 
\end{minipage}
} \\
\midrule
\texttt{metapostCommand} & \texttt{mpost}\index{metapost}\index{mpost}     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The command for conversion of gnuplot-files 
into metapost's postscript. 
% The default value is 'mpost'. 
\end{minipage}
} \\
\texttt{metapostOptions} & see Section~\ref{subsec:metapostOptions} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the command \texttt{\$metapostCommand}.
Leading and trailing blanks are ignored. 
A sequence of at least one blank separate the proper options. 
%The default value is 
%'\texttt{-interaction=nonstopmode -recorder -s prologues=2}'. 
\end{minipage}
} \\
\midrule
\texttt{svg2devCommand} & \texttt{inkscape} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The command for conversion of svg-files into a mixed format. 
%The default value is 'inkscape'. 
\end{minipage}
} \\
\texttt{svg2devOptions} & \texttt{-z -D --export-latex} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the command \texttt{\$svg2devCommand} 
for exporting svg-figures into latex compatible files. 
For more details see Section~\ref{subsec:svg2devOptions}. 
\end{minipage}
} \\
\midrule
\texttt{ebbCommand} & \texttt{ebb} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The command to create bounding box information 
from jpg-files and from png-files. 
This is run twice: 
once with parameter `\texttt{-m}' 
to create `.bb'-files for driver `\texttt{dvipdfm}' and 
once with parameter `\texttt{-x}' 
to create `.xbb'-files for driver `\texttt{dvipdfmx}'. 
% The default value is 'ebb'. 
\end{minipage}
} \\
\texttt{ebbOptions} & \texttt{-v} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the command \texttt{\$ebbCommand} 
except `\texttt{-m}' and `\texttt{-x}' 
which are added automatically. 
% The default value is `-v'. 
\end{minipage}
} \\
\end{longtable}

\subsection{The parameter \texttt{metapostOptions}}
\label{subsec:metapostOptions}
TODO\@: add 
%%\texttt{\small -interaction=nonstopmode -recorder -s prologues=2}

\subsection{The parameter \texttt{svg2devOptions}}
\label{subsec:svg2devOptions}

The following options are mandatory: 
%
\begin{itemize}
\item `-z' or `--without-gui' 
process files from console. 
\item `-D' or `--export-area-drawing' 
Export the drawing (not the page)
\item `--export-latex' 
Export into PDF/PS/EPS format without text. 
Besides the PDF/PS/EPS files, a \LaTeX-file \texttt{latexfile.tex} is exported,
putting the text on top of the PDF/PS/EPS file. 
Include the result in LaTeX as: 
\cmd{input\{latexfile.tex\}}. 

Note that the latter option is necessary, 
to create the expected files. 
It is also conceivable to export text as pdf/eps 
\end{itemize}

\noindent
The following options are prohibited, 
because they are automatically added by the software: 
\begin{itemize}
\item `-A=FILENAME' or `--export-pdf=FILENAME' 
Export document to a  PDF file. 
\item `-E=FILENAME' or `--export-eps=FILENAME' 
Export document to an EPS file. 		 
\end{itemize}
% The default value is the minimal value, `-z -D - -export-latex'. 


\section{Parameters for the \LaTeX-to-pdf Conversion}
\label{sec:settingsLatex2pdf}

This section describes the parameters 
of the \LaTeX-to-pdf converter 
which are given in Table~\ref{tab:paramLatex2pdf}. 

TODO\@: do this. 


\begin{longtable}{|ll|}
\toprule
Parameter        & Default  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:paramLatex2pdf} The \LaTeX-to-pdf-converter}
\endlastfoot%
\texttt{latex2pdfCommand}       & \texttt{pdflatex}      \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The \LaTeX{} command to create a pdf-file with. 
%The default value is '\texttt{pdflatex}'. 
\end{minipage}
} \\
\texttt{latex2pdfOptions}   & see Section~\ref{subsec:latex2pdfOptions} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the command \texttt{\$latex2pdfCommand}.
Leading and trailing blanks are ignored. 
A sequence of at least one blank separate the proper options. 

FIXME\@:  -output-format is not allowed because set automatically. 
%The default value is 
%'\texttt{-interaction=nonstopmode -src-specials}'. 
\end{minipage}
} \\
\texttt{patternErrLatex} & \texttt{(\^{}!\ )} \\% chktex 37
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the log-file 
and matching indicating an error 
emitted by the command \texttt{\$latex2pdfCommand}. 

The default value is chosen to match quite exactly 
the latex errors in the log file, no more no less. 
Since no official documentation was found, 
the default pattern may be incomplete. 
In fact it presupposes, that \texttt{\$latex2pdfOptions} 
does not contain ``\texttt{-file-line-error-style}''.   

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the deficiency. 
\end{minipage}
} \\
\texttt{patternWarnLatex} & see Section~\ref{subsec:patternWarnLatex} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the log-file 
and matching indicates a warning 
emitted by the command \texttt{\$latex2pdfCommand}, 
disregarding warnings on bad boxes 
provided \texttt{\$debugWarnings} is set. 

This pattern may never be ensured to be complete, 
because any package may indicate a warning 
with its own pattern any new package may break completeness. 
Nevertheless, the default value aims completeness 
while be restrictive enough 
not to indicate a warning where none was emitted. 

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the deficiency. 
% The default value is given below. 
\end{minipage}
} \\
\texttt{debugBadBoxes}    & \texttt{true}          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Whether debugging of overfull/underfull hboxes/vboxes is on: 
If so, a bad box occurs in the last \LaTeX{} run, a warning is displayed. 
For details, set \texttt{\$cleanUp} to false, 
rerun \LaTeX{} and have a look at the log-file.
%The default value is '\texttt{true}'. 
\end{minipage}
} \\
\texttt{debugWarnings}    & \texttt{true}          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Whether debugging of warnings is on: 
If so, a warning in the last \LaTeX{} run is displayed. 
For details, set \texttt{\$cleanUp} to false, 
rerun \LaTeX{} and have a look at the log-file. 
%The default value is '\texttt{true}'. 
\end{minipage}
} \\
\texttt{pdfViaDvi}    & \texttt{false}          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Whether creation of pdf-files from \LaTeX-files 
goes via dvi-files. 

If \texttt{\$pdfViaDvi} is set 
and the latex processor needs repetitions, 
these are all done creating dvi 
and then pdf is created in a final step 
invoking the command \texttt{\$dvi2pdfCommand} 
If \texttt{\$pdfViaDvi} is not set, 
latex is directly converted into pdf. 

Currently, not only conversion of \LaTeX-files is affected, 
but also conversion of graphic files 
into graphic formats which allow inclusion in the tex-file. 
If it goes via latex, 
then the formats are more based on (encapsulated) postscript; 
else on pdf. 

Of course, the target dvi is not affected: 
This uses always the dvi-format. 
What is also affected are the tasks 
creating html, odt or docs: 
Although these are based on htlatex which is always dvi-based, 
the preprocessing is done in dvi or in pdf. 
Also the task txt is affected. 

%The default value is '\texttt{false}'. 
\end{minipage}
} \\
\texttt{dvi2pdfCommand}   & \texttt{dvipdfmx}         \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The driver to convert dvi into pdf-files. 
Note that this must fit the options 
of the packages `\pkg{xcolor}' and `\pkg{graphicx}'. 
Sensible values are 
`\texttt{dvipdf'}, `\texttt{dvipdfm'}, `\texttt{dvipdfmx}', 
and `\texttt{dvipdft}' 
(which is `\texttt{dvipdfm}' with option `\texttt{-t}').  
%The default value is `dvipdfmx'. 
\end{minipage}
} \\
\texttt{dvi2pdfOptions}   & the empty string          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the command \texttt{\$dvi2pdfCommand}. 
%The default value is the empty string.
\end{minipage}
} \\
\texttt{patternReRunLatex} &  see Section~\ref{subsec:patternReRunLatex} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the log file 
and matching triggers rerunning \texttt{\$latex2pdfCommand} 
if \texttt{\$maxNumReRunsLatex} is not yet reached 
to ensure termination. 

This pattern may never be ensured to be complete, 
because any package 
may indicate the need to rerun \texttt{\$latex2pdfCommand} 
with its own pattern and so any new package may break completeness. 
Nevertheless, the default value aims completeness 
while be tight enough not to trigger a superfluous rerun. 

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the deficiency. 
\end{minipage}
} \\
\texttt{maxNumRerunsLatex}        & \texttt{5}               \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The maximal allowed number of reruns of the \LaTeX{} process. 
This is to avoid endless repetitions. 
%The default value is 5. 
This shall be non-negative 
or -1 which signifies that there is no threshold. 
\end{minipage}
} \\
\end{longtable}


\subsection{The parameter \texttt{latex2pdfOptions}}
\label{subsec:latex2pdfOptions}
TODO\@: add 
%-interaction=nonstopmode -synctex=1 -src-specials -recorder -shell-escape 


\subsection{The parameter \texttt{patternWarnLatex}}
\label{subsec:patternWarnLatex}

The patterns given below are just by (unwritten) convention. 
As a consequence, the pattern has a comprehensive default value 
covering all warnings known to the author, 
while not detecting a warning, where there is none. 
To that end, the pattern requires 
that the warning text starts with the line of the log file. 
Still the pattern has to be configurable 
to allow the user to overwrite the default value 
not being forced to wait for the developer 
to change it. 

For the current default value, we distinguish 
%
\begin{itemize}
\item
\LaTeX-warnings emitted directly by \LaTeX 
starting with \texttt{LaTeX Warning: }, 
\item
\LaTeX-font-warnings related with fonts/font selection 
starting with \texttt{LaTeX Font Warning: }, 
\item
Package warnings emitted by a package. 
By convention, a package emitting a warning identifies itself 
by its name \texttt{<name>}
emitting a warning starting with \texttt{Package <name> Warning: }, 
\item
Class warnings emitted by a package. 
By convention, a class emitting a warning identifies itself 
by its name \texttt{<name>}
emitting a warning starting with \texttt{Class <name> Warning: }, 
\item
pdftex-warning 
\item
Fontspec warnings. Please note the leading character ``\texttt{*}''. 
\item
Further warnings not identifying themselves as warnings 
as the word ``warning'' does not occur. 
\end{itemize}

The resulting default pattern is 
%
\begin{Verbatim}
^(LaTeX Warning: |
LaTeX Font Warning: |
(Package|Class) .+ Warning: |
pdfTeX warning( \((\d|\w)+\))?: |
\* fontspec warning: |
Missing character: There is no .* in font .*!$|
A space is missing\. (No warning)\.)
\end{Verbatim}
%$ for emacs only 


\subsection{The parameter \texttt{patternReRunLatex}}
\label{subsec:patternReRunLatex}
TODO\@: add 

The pattern to 

As a consequence, the pattern has a comprehensive default value 
covering all warnings known to the author, 
while not detecting a warning, where there is none. 
To that end, the pattern requires 
that the warning text starts with the line of the log file. 
Still the pattern has to be configurable 
to allow the user to overwrite the default value 
not being forced to wait for the developer to change it. 

For the current default value, we distinguish 

The resulting default pattern is 
%
\begin{Verbatim}[fontsize=\scriptsize]
^(LaTeX Warning: Label\(s\) may have changed\. Rerun to get cross-references right\.$|
Package \w+ Warning: .*Rerun( .*|\.)$|
Package \w+ Warning: .*$^\(\w+\) .*Rerun .*$|
LaTeX Warning: Etaremune labels have changed\.$|
\(rerunfilecheck\)                Rerun to get outlines right$)
\end{Verbatim}

FIXME: There is a bug in this pattern. See Section~\ref{chap:bugs}. 


\section{Parameters for Creation of the Bibliography}
\label{sec:settingsBibTeX}

This section describes the parameters 
or creation of the bibliography
which are given in Table~\ref{tab:paramBibTeX}. 

TODO\@: do this. 

\begin{longtable}{|ll|}
\toprule
Parameter        & Default  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:paramBibTeX} The BibTeX-utility }
\endlastfoot%
\texttt{bibtexCommand}    & \texttt{bibtex}        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The BibTeX command to create a bbl-file 
from an aux-file and a bib-file (using a bst-style file). 
%The default value is '\texttt{bibtex}'. 
\end{minipage}
} \\
\texttt{bibtexOptions}    & empty        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the command \texttt{\$bibtexCommand}. 
% The default value is the empty string.
\end{minipage}
} \\
\texttt{patternErrBibtex}    & \texttt{error message}        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the blg-file 
and matching indicates that \texttt{\$bibtexCommand} failed. 
The default value is chosen 
according to the `\texttt{bibtex}' documentation. 
\end{minipage}

} \\
\texttt{patternWarnBibtex}    & \texttt{\^{}Warning-{}-}        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the blg-file 
and matching indicates a warning \texttt{\$bibtexCommand} emitted. 
The default value is chosen 
according to the `\texttt{bibtex}' documentation. 
\end{minipage}
} \\
\end{longtable}

\section{Parameters for Creation of the Indices}
\label{sec:settingsMakeIndex}

This section describes the parameters 
or creation of the indices
which are given in Table~\ref{tab:paramMakeIndex}. 

TODO\@: do this. 


\begin{longtable}{|ll|}
\toprule
Parameter        & Default  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:paramMakeIndex} 
The utilities MakeIndex and SplitIndex}
\endlastfoot%
\texttt{makeIndexCommand} & \texttt{makeindex}     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The MakeIndex command to create an ind-file from an idx-file 
logging on an ilg-file. 
%The default value is '\texttt{makeindex}'. 
\end{minipage}
} \\
\texttt{makeIndexOptions} & the empty string     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the MakeIndex command. 
% The default value is the empty string. 
\end{minipage}
} \\
\texttt{patternErrMakeIndex} 
& \texttt{(!! Input index error\ )} \\% chktex 36 % chktex 37
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the ilg-file 
and matching indicates that \texttt{\$makeIndexCommand} failed. 
The default value is chosen 
according to the `\texttt{makeindex}' documentation.
\end{minipage}
} \\
\texttt{patternWarnMakeIndex} & \texttt{(\#\# Warning )} \\% chktex 37
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the ilg-file 
and matching indicates a warning \texttt{\$makeIndexCommand} emitted. 
The default value is chosen 
according to the `\texttt{makeindex}' documentation.
\end{minipage}
} \\
\texttt{patternReRunMakeIndex} & see Section~\ref{subsec:patternReRunMakeIndex} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the log-file 
and matching triggers rerunning \texttt{\$makeIndexCommand} 
followed by \texttt{\$latex2pdfCommand}. 

This pattern only matches a warning 
emitted by the package `\pkg{rerunfilecheck}' 
e.g. used with option `\texttt{index}'. 
The default value 
is chosen according to the package documentation. 

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the bug. 
\end{minipage}
} \\
\texttt{splitIndexCommand} & \texttt{splitindex}     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The SplitIndex command to create ind-files 
from an idx-file logging on ilg-files. 
This command invokes \texttt{\$makeIndexCommand}. 
%The default value is `splitindex'. 
\end{minipage}
} \\
\texttt{splitIndexOptions} & \texttt{-V}     \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for \texttt{\$splitIndexCommand}. 
Here, one has to distinguish between the options 
processed by \texttt{\$splitIndexCommand} 
and those passed to \texttt{\$makeIndexCommand}. 
The second category cannot be specified here, 
it is already given by \texttt{\$makeIndexOptions}. 
In the first category is the option `\texttt{-m}' 
to specify the \texttt{\$makeIndexCommand}. 
This is used automatically and cannot be specified here. 
Since \texttt{\$splitIndexCommand} is used 
in conjunction with package `\texttt{splitidx}', 
which hardcodes various parameters 
which are the default values for \texttt{\$splitIndexCommand} 
and because the option may not alter certain interfaces, 
the only option which may be given explicitly 
is `\texttt{-V}', the short cut for `\texttt{--verbose}'. 
Do not use `\texttt{--verbose}' either for sake of portability. 
%The default value is `-V'; it could also be empty. 
\end{minipage}
} \\
\end{longtable}


\subsection{The parameter \texttt{patternReRunMakeIndex}}
\label{subsec:patternReRunMakeIndex}

As shown in \cite{RerunFChkP}, Section 2.3, Listing line 166, 
the pattern is 
%
\begin{Verbatim}
(^\(rerunfilecheck\) +Rerun LaTeX/makeindex to get index right\.$)
\end{Verbatim}
%$ for emacs only 


\section{Parameters for Creation of the Glossary}
\label{sec:settingsMakeGlossaries}

This section describes the parameters 
or creation of the glossary
which are given in Table~\ref{tab:paramMakeGlossaries}. 

TODO\@: do this. 



\begin{longtable}{|ll|}
\toprule
Parameter        & Default  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:paramMakeGlossaries} The MakeGlossaries-utility }
\endlastfoot%
\texttt{makeGlossariesCommand} & \texttt{makeglossaries}         \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The MakeGlossaries command to create a gls-file 
from a glo-file (invoked without file ending) 
also taking ist-file or xdy-file 
into account logging on a glg-file. 
\end{minipage}
} \\
\texttt{makeGlossariesOptions} & the empty string          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for the \texttt{\$makeGlossariesCommand}. 
These are the options for `\texttt{makeindex}' (not for \texttt{\$makeIndexCommand}) 
and for `\texttt{xindy}' (also hardcoded). 
The aux-file decides on whether program is executed 
and consequently which options are used. 
		 
The default value is the empty option string. 
Nevertheless, `\texttt{xindy}' is invoked as `\texttt{xindy -L english  -I xindy -M\ldots}'. 
With option `\texttt{-L german}', this is added. 
Options `\texttt{-M<}' for `\texttt{xindy}' 
`\texttt{-s}' for `\texttt{makeindex}' and `\texttt{-t}' and `\texttt{-o}' for both, 
`\texttt{xindy}' and `\texttt{makeindex}'. 
\end{minipage}
} \\
\texttt{patternErrMakeGlossaries} & 
\texttt{(\^{}\textbackslash*\textbackslash*\textbackslash* unable to execute:\ )} \\% chktex 37
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the `glg'-file 
and matching indicates that \texttt{\$makeGlossariesCommand} failed. 
The default value `\texttt{(\^\*\*\* unable to execute: )}' 
is chosen according to the 'makeindex' documentation. 
If the default value is not appropriate, please modify 
and notify the developer of this plugin. 
\end{minipage}
} \\
\texttt{patternErrXindy} & \texttt{(\^{}ERROR:\ )} \\% chktex 36 chktex 37
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern in the `glg'-file 
which indicates an error when running `\texttt{xindy}' 
via \texttt{\$makeGlossariesCommand}. 
If the default value is not appropriate, please modify 
and notify the developer of this plugin. 
\end{minipage}
} \\
\texttt{patternWarnXindy} & \texttt{(\^{}WARNING:\ )}         \\% chktex 37
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the `glg'-file 
and matching indicates a warning when running `\texttt{xindy}' 
via \texttt{\$makeGlossariesCommand}. 

The default value `\texttt{(\^{}WARNING: )}' 
(note the space and the brackets) 
is chosen according to the '\texttt{xindy}' documentation. 

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the deficiency. 
\end{minipage}
} \\
\texttt{patternReRunMakeGlossaries}  
& see Section~\ref{subsec:patternReRunMakeGlossaries}   \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied line-wise to the log file 
and matching triggers rerunning \texttt{\$makeGlossariesCommand} 
followed by \texttt{\$latex2pdfCommand}. 

This pattern only matches a warning 
emitted by the package `\pkg{rerunfilecheck}' 
e.g. used with option `\texttt{glossary}'. 
The default value 
is chosen according to the package documentation. 

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the bug. 
\end{minipage}
} \\
\end{longtable}

\subsection{The parameter \texttt{patternReRunMakeGlossaries}}
\label{subsec:patternReRunMakeGlossaries}

As shown in \cite{RerunFChkP}, Section 2.3, Listing line 210, 
the pattern is 
%
\begin{Verbatim}
(^\(rerunfilecheck\) +Rerun LaTeX/makeindex to get index right\.$)
\end{Verbatim}
%$ for emacs only 

This holds even if \texttt{splitindex} is used. 


\section{Parameters for  Conversion \LaTeX{} to html}
%\section{Parameters for the \LaTeX-to-html Conversion}
\label{sec:settingsLatex2Html}

This section describes the parameters 
of the \LaTeX-to-html converter 
which are given in Table~\ref{tab:paramLatex2Html}. 

%TODO\@: do this. 



\begin{longtable}{|ll|}
\toprule
Parameter        & Default  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:paramLatex2Html} The \LaTeX-to-html-converter }
\endlastfoot%
\texttt{tex4htCommand}       & \texttt{htlatex}  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
\end{minipage}
} \\
\texttt{tex4htStyOptions}    & \texttt{xhtml,uni-html4,2,svg,pic-tabular}  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
\end{minipage}
} \\
\texttt{tex4htOptions}       & \texttt{' -cunihtf -utf8'}         \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
\end{minipage}
} \\
\texttt{t4htOptions}         & the empty string              \\%-cvalidate
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options for `\texttt{t4ht}' which converts idv-file and lg-file 
into css-files, tmp-file and, 
by need and if configured accordingly into \gls{png}-files. 
The value `\texttt{-p}' prevents creation of \gls{png}-pictures.
%The default value is the empty string. 
\end{minipage}
} \\
\texttt{patternT4htOutputFiles} & 
see Section~\ref{subsec:patternT4htOutputFiles}\\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pattern is applied to file names 
and matching shall accept 
exactly the target files of goal `\texttt{html}' 
for a given latex main file `\texttt{xxx.tex}'. 
Matching triggers copying those files to \texttt{\$outputDirectory}. 

The patterns for the other targets 
are hardcoded and take the form 
`\texttt{\^{}T\$T\textbackslash.yyy\$}', where `\texttt{yyy}' 
may be an ending or an alternative of endings. 
This pattern is neither applied to directories 
nor to `\texttt{xxx.tex}' itself. 
 
For an explanation of the pattern `\texttt{T\$T}' 
see \texttt{\$patternCreatedFromLatexMain}. 
Spaces and newlines are removed 
from that pattern before processing. 

The pattern is designed to match quite exactly 
the files to be copied to \texttt{\$targetSiteDirectory}, 
for the goal `\texttt{html}', 
not much more and at any case not less. 
since \texttt{\$tex2htCommand} is not well documented, 
and still subject to development, 
this pattern cannot be guaranteed to be final. 

If the current default value is not appropriate, 
please overwrite it in the configuration 
and notify the developer of this plugin of the bug. 
\end{minipage}
} \\
\end{longtable}


\subsection{The parameter \texttt{patternT4htOutputFiles}}
\label{subsec:patternT4htOutputFiles}



The default value has the following components: 
%
\begin{itemize}
\item
`\texttt{\^{}T\$T\textbackslash.x?html?\$}' is the main output file. 
\item
`\texttt{\^{}T\$Tli\textbackslash d+\textbackslash.x?html?\$}' are lists: 
toc, lof, lot, indices, glossaries, NOT the bibliography. 
\item
'\texttt{\^{}T\$T(ch|se|su|ap)\textbackslash d+\textbackslash.x?html?\$}' 
are chapters, sections and subsections or below 
and appendices. 
\item
`\texttt{\^{}T\$T\textbackslash d+\textbackslash.x?html?\$}' are footnotes. 
\item
`\texttt{\^{}T\$T\textbackslash.css\$}' are cascaded stylesheets. 
\item
`\texttt{\^{}T\$T-\textbackslash d+\textbackslash.svg\$}' and 
`\texttt{\^{}T\$T\textbackslash d+x\textbackslash.png\$}' 
are svg/png-files representing figures. 
\item
`\texttt{\^({}T\$T\textbackslash d+x\textbackslash.x?bb}' 
are the bounding boxes 
(suffix \texttt{.bb}  for \texttt{dvipdfm} and 
 suffix \texttt{.xbb} for \texttt{dvipdfmx}). 
\item
`\texttt{\^{}(cmsy)\textbackslash d+(-c)?-\textbackslash d+c?\textbackslash.png\$}' 
represents special symbols. 
\end{itemize}
		 
Note that the patterns for the html-files can be summarized as 
%
\begin{Verbatim}
^T$T((ch|se|su|ap|li)?\d+)?\.x?html?\$
\end{Verbatim}
%$ for emacs 

This altogether constitutes the default value for this pattern: 
%
\begin{verbatim}
^(T$T(((ch|se|su|ap|li)?\d+)?\.x?html?|
\.css|
\d+x\.x?bb|
\d+x\.png|
-\d+\.svg)|
(cmsy)\d+(-c)?-\d+c?\.png)$
\end{verbatim}

The pattern is designed to match quite exactly 
the files to be copied to \texttt{\$targetSiteDirectory}, 
for the goal ``html'', 
not much more and at any case not less. 
since \texttt{\$tex2htCommand} is not well documented, 
and still subject to development, 
this pattern cannot be guaranteed to be final. 


\section{Parameters for further Conversions }
\label{sec:settingsExt}

This section describes the parameters 
of the converter from and to further formats 
which are given in Table~\ref{tab:paramExt}. 

These converters convert latex into rtf directly, 
they convert odt into doc-like documents and pdf into pure text. 
A special case is the code-checker 
in a sense converting latex into a log-file. 
For each of them, the name of the command can be specified 
and also the options. 
Since neither of them, except the code checker, write a log-file, 
there are no further parameters necessary. 


\begin{longtable}{|ll|}
\toprule
Parameter        & Default  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:paramExt} The parameters of further converters }
\endlastfoot%
\texttt{latex2rtfCommand}    & \texttt{latex2rtf}        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The latex2rtf command to create rtf from latex directly. 
%The default value is '\texttt{latex2rtf}'. 
\end{minipage}
} \\
\texttt{latex2rtfOptions}    & the empty string        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options of the command \texttt{\$latex2rtfCommand}. 
% The default value is the empty string. 
\end{minipage}
} \\
\texttt{odt2docCommand}      & \texttt{odt2doc}          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The odt2doc command to create MS word-formats from otd-files. 
%The default value is '\texttt{odt2doc}'. 
\end{minipage}
} \\
\texttt{odt2docOptions}      & \texttt{-fdocx}          \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options of the command \texttt{\$odt2docCommand}. 
Above all specification of output format 
via the option '-f'. 
Invocation is '\texttt{odt2doc -f$<$format$>$ $<$file$>$.odt}'. 
All output formats are shown by `\texttt{odt2doc --show}' 
but the formats interesting in this context 
are the following: 
\texttt{doc}, \texttt{doc6}, \texttt{doc95}, \texttt{docbook}, \texttt{docx}, 
\texttt{docx7}, \texttt{ooxml} and \texttt{rtf}. 
Interesting also the verbosity options 
`\texttt{-v}', `\texttt{-vv}', `\texttt{-vvv}' 
the timeout `\texttt{-T=secs}' and `\texttt{--preserve}' 
to keep permissions and timestamp of the original document. 
%The default value is '\texttt{-fdocx}'. 
\end{minipage}
} \\
\texttt{pdf2txtCommand}      & \texttt{pdftotext}        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The pdf2txt-command for converting pdf-files 
into plain text files. 
%The default value is '\texttt{pdftotext}'. 
\end{minipage}
} \\
\texttt{pdf2txtOptions}      & the empty string  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options of the command \texttt{\$pdf2txtCommand}. 
%The default value is the empty string. 
\end{minipage}
} \\
\texttt{chkTexCommand}      & \texttt{chktex}        \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The chktex-command for checking latex main files. 
%The default value is 'chktex'. 
\end{minipage}
} \\
\texttt{chkTexOptions}      & \texttt{-q -b}  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The options of the command \texttt{\$chkTexCommand}, 
except ``\texttt{-o output-file}'' 
specifying the output file which is added automatically. 
For further details see Section~\ref{subsec:chkTexOptions}. 
%The default value is '\texttt{-q -b}'. 
\end{minipage}
} \\
\end{longtable}





FIXME\@: 
Note that \texttt{pdftotext -h} prints a usage message. 
This is a way to obtain not the specified output. 
It shows that \texttt{pdftotext -q} does not print any messages or errors. 
This indicates that \texttt{pdftotext} normally does display error messages 
on the standard output. 
These may be led to a log file to indicate errors and warnings. 
Here, further research is required. 

The option \texttt{-htmlmeta} seems not approprate. 
The option resolution \texttt{-r} seems sensible only in conjunction 
with the crop area defined by \texttt{-x} and \texttt{-y} 
which does not make sense in our context. 
The same holds for specification of the first and the last page 
via \texttt{-f} and \texttt{-l}. 
What does make sense is specifying the encoding via \texttt{-enc} 
with possible values given by \texttt{pdftotext -listenc}. 
What makes sense most is \texttt{UTF-8}. 




\subsection{The parameter \texttt{chkTexOptions}}
\label{subsec:chkTexOptions}

The options of \texttt{chktex} 
are described in detail in~\cite{ChkTeX}, Section 6.1.2. 

Here is a list of options useful in this context. 
The first group of these are muting options: 
%
\begin{itemize}
\item '-w', '-e', '-m', 
Make the message number passed as parameter 
a warning/an error/a message and turns it on. 
Messages are not counted. 
\item '-n'
Turns the warning/error number passed as a parameter off. 
\item '-L'
Turns off suppression of messages on a per line basis. 
\end{itemize}

The next group of interesting options are for output control: 
%
\begin{itemize}
\item['-q']
Shuts up about copyright information.
\item['-o output-file']
Specifies the output file. This is added automatically 
and shall thus not be specified by the user. 
\item['-b0/1']
If you use the -o switch, and the named output-file exists,
it will be renamed to `filename.bak' for option \texttt{-b1} 
and not for \texttt{-b0}.
\item['-f format']
Specifies the format of the output 
via a format similar to ``\texttt{printf()}'. %chktex 36
For details consult the manual~\cite{ChkTeX}, Section 6.1.2. 
The codes are listed below. 
\item['-vd']
Verbosity level followed by a number `d' 
specifying the format of the output according to the listing below. 
The verbosity number is resolved as a pattern 
as if given by the option `-f format'. 
Thus the option `-v' is ignored 
if the option `-f format' is specified. 
\end{itemize}

The default value \texttt{-q -b0} 
avoids verbose output and backing up the output log-file. 

Code
%
\begin{itemize}
\item[\%b]
String to print between fields (from -s option).
\item[\%c]
Column position of error.
\item[\%d]
Length of error (digit).
\item[\%f]
Current file-name.
\item[\%i]
Turn on inverse printing mode.
\item[\%I]
Turn off inverse printing mode.
\item[\%k]
kind of error (warning, error, message).
\item[\%l]
line number of error.
\item[\%m]
Warning message.
\item[\%n]
Warning number.
\item[\%u]
An underlining line (like the one which appears when using '-v1').
\item[\%r]
Part of line in front of error ('S'-1).
\item[\%s]
Part of line which contains error (string).
\item[\%t]
Part of line after error ('S'+1).
\end{itemize}



FIXME\@: to be inserted. 
From \texttt{chktexrc}: 
\begin{verbatim}
OutFormat
{
# -v0; silent mode
%f%b%l%b%c%b%n%b%m!n

# -v1; normal mode
"%k %n in %f line %l: %m!n%r%s%t!n%u!n"

# -v2; fancy mode
"%k %n in %f line %l: %m!n%r%i%s%I%t!n!n"

# -v3; lacheck mode
"!"%f!", line %l: %m!n"

# -v4; verbose lacheck mode
"!"%f!", line %l: %m!n%r%s%t!n%u!n"

# -v5; no line number, ease auto-test
"%k %n in %f: %m!n%r%s%t!n%u!n"

# -v6; emacs compilation mode
"!"%f!", line %l.%c:(#%n) %m!n"
}
\end{verbatim}

Note that ``\texttt!'' is to escape quotes and newline. 
More than these can be added to \texttt{chktexrc}. 


This document is checked with options deviating from the default value: 
%
\begin{verbatim}
-q -b0 -v1 -g0 -l ${basedir}/src/site/tex/chktexrc
\end{verbatim}
%
The default is \texttt{-q -b0}, 
option \texttt{-g0} means that the global \texttt{chktexrc} is not used 
and option 
%
\begin{verbatim}
-l ${basedir}/src/site/tex/chktexrc
\end{verbatim}
%
specifies a record file tailored to the needs of this project. 
In particular, the pattern for \texttt{-v1} is slightly modified: 
It is 
%
\begin{verbatim}
# -v1; normal mode
"%k %n in %f line %l: %m!n %r%s%t!n %u!n"
\end{verbatim}
%
which adds a blank to all lines but the headlines. 
That way, the kind of issue (\%k) is easily parsed. 
This could be used for emitting an error instead of a warning 
when processing goal {\em check}. 



\chapter{Exceptions and Logging}\label{chap:exceptionLogging}

If during execution of this software something goes wrong 
and it is possible to detect that, the user shall be notified. 

Maven foresees a mechanism to abort the whole build, i.e.~lifecycle phase 
or a single goal and accordingly ant allows to abort a task. 
In both cases, abortion is implemented by throwing an exception. 


A maven plugin aborts a goal throwing a 
%
\begin{verbatim}
org.apache.maven.plugin.MojoFailureException
\end{verbatim}
%
and a 
%
\begin{verbatim}
org.apache.maven.plugin.MojoExecutionException 
\end{verbatim}
%
to abort the life-cycle phase. 
Since this plugin is just for documentation, 
there is no need to abort site creation altogether, 
so only the former exception occurs. 

An ant-task aborts an ant-build throwing a
%
\begin{verbatim}
org.apache.tools.ant.BuildException
\end{verbatim}
%
without further distinction. 

This software provides both a maven plugin and an ant task 
built on the same code base. 
Thus the maven plugin throws a \texttt{MojoFailureException} 
if and only if the according ant-task throws an \texttt{BuildException} 
in the same situation. 

Section~\ref{sec:exception} describes 
the philosophy of throwing an exception and 
defines in detail under what circumstances which exception is thrown. 

Roughly speaking, an exception is thrown only if something is really wrong, 
e.g.~a non-recoverable error or an indication 
that the build system is out of control or if this plugin/task 
is likely to destroy the work of another plugin/task. 

If something went wrong, but no exception is thrown, 
the user must be notified by logging 
and the build process to go on, 
skipping a section of a task as small as possible. 
Both, maven and ant provide a logging mechanism 
with the levels error, warning, info and debug. 
Section~\ref{sec:logWarnErr} describes the errors and warnings; 
the lot of infos and debugging output are not described here. 

Verbosity is chosen by the following command line options: 
%
\begin{itemize}
\item[\texttt{-e}] shows error messages, 
\item[\texttt{-X}] shows debug-messages, 
\item[\texttt{-q}] quiet hides the info-level and shows {\em only\/} errors. 
\end{itemize}
%
There seems no way to get warnings only. 

Each exception offers a message and also each warning has a warning message. 
The messages are endowed with a unique identifier of the form 
\texttt{KCCDD}, where \texttt{K} is the kind which is one of 
%
\begin{itemize}
\item[T] Throwable, 
which results in a \texttt{MojoFailureException} for the maven-plugin 
and \texttt{BuildException} for the ant-task. 
This is described in detail in Section~\ref{sec:exception} 
\item[E] logging as ERROR, 
\item[W] logging as WARNING 
\item[I] logging as INFO which occurs frequently
\item[D] logging as DEBUGGING output, which is lengthy 
\end{itemize}

The shortcut \texttt{CC} describes the class where the exception is thrown 
or the warning is logged: 
%
\begin{itemize}
\item[EX] CommandExectutorImpl: 
a class executing applications on a command line. 
\item[PP] LatexPreProcessor: preprocessing of \LaTeX-files: 
Processing of graphic files and detection of latex main files. 
\item[LP] LatexProcessor: processing of \LaTeX-main files: 
conversion into various output formats. 
\item[SS] Settings: A container holding the values of all parameters. 
These are either default or read from the configuration 
in the pom for the maven plugin and in the build file for the ant task. 
\item[MI] MetaInfo: offering meta information
  as expected and actual versions of converters. 
\item[FU] TexFileUtilsImpl: a class providing access to files. 
\end{itemize}
%
Finally, \texttt{DD} is a two digit number enumerating the messages.


\begin{longtable}{|ll|}
\toprule
Identifier        & Message  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:LogMI} The logging for MetaInfo   }
\endlastfoot%
\texttt{\footnotesize WMI01} 
& \texttt{\footnotesize Version string from converter \$conv did not match expected form:      } \\
& \texttt{\footnotesize \$conv: 'version'not?in\$interv } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
  Indicates that the version string coming from the converter \$conv
  is not as expected.
  Programming error excluded, this means that the version does not fit,
  i.e. is not in \texttt{\$interv}.
\end{minipage}
} \\
\texttt{\footnotesize WMI02} 
& \texttt{\footnotesize \$conv: '\$actVersion'not in\$interv} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
  Indicates that the version of converter \$conv can be detected
  and is \$actVersion but does not fit the expectation which is \$expVersion. 
\end{minipage}
}
\end{longtable}




\begin{longtable}{|ll|}
\toprule
Identifier        & Message  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:LogFU} The logging for TexFileUtils   }
\endlastfoot%
\texttt{\footnotesize WFU01} 
& \texttt{\footnotesize Cannot read directory '\$dir';  } \\
& \texttt{\footnotesize build may be incomplete. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
TBD. 
\end{minipage}
} \\
\texttt{\footnotesize XFU02} 
& \texttt{\footnotesize  TBD} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
TBD
\end{minipage}
} \\
\texttt{\footnotesize WFU03}  & \texttt{\footnotesize Cannot close '\$file'.} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
TBD
\end{minipage}
} \\
\texttt{\footnotesize EFU05}  & \texttt{\footnotesize Cannot delete file '\$file'.} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
TBD
\end{minipage}
} \\
\texttt{\footnotesize EFU06}  & \texttt{\footnotesize Cannot move file '\$src'
                                to '\$dest'.} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
TBD
\end{minipage}
} \\
\texttt{\footnotesize EFU07}  & \texttt{\footnotesize File '\$srcFile' to be filtered cannot be read.} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
  WORKAROUND for \texttt{inkscape}
  filtering \texttt{eps\_tex}-file into \texttt{ptx} file:
  The former is not a readable regular file. 
\end{minipage}
} \\
\texttt{\footnotesize EFU08}  & \texttt{\footnotesize Destination file '\$destFile' for filtering cannot be written.} \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
 WORKAROUND for \texttt{inkscape}
  filtering \texttt{eps\_tex}-file into \texttt{ptx} file:
  The latter is not a writable regular file. 
\end{minipage}
} \\
\texttt{\footnotesize EFU09}  & \texttt{\footnotesize Cannot filter file '\$srcFile' into '\$destFile'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
 WORKAROUND for \texttt{inkscape}
  filtering \texttt{eps\_tex}-file into \texttt{ptx} file:
  Either reading a line or writing a line failed. 
\end{minipage}
} \\
\end{longtable}
TBD: check whether workaround still necessary. 
TBD: complete list
TBD: add missing lists 


\section{Exceptions}\label{sec:exception}

Exceptions are thrown only if no substantial part of 
this maven-goal or this ant-task may be completed 
as if the tex source directory does not exist or is no directory 
or if a failure occurs which indicates 
that the underlying system does not work properly, 
as if the tex source directory or a sub-directory is not readable 
or if execution of an external program fails. 
The latter does not mean that the program returns with an error code, 
but it means that execution from within java fails.

\begin{longtable}{|ll|}
\toprule
Identifier        & Message  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:TEX} The \texttt{BuildFailureException}s of the internal class
  CommandExecutorImpl }
  % TBD: find out why the above texttt does not show up in the text. 
\endlastfoot%
\texttt{\footnotesize TEX01} & \texttt{\footnotesize Error running \$command. }  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Compare with EEX01 in Table~\ref{tab:WarnCEI}: 
Error execution means 
%
\begin{itemize}
\item
the file expected to be the working directory 
does not exist or is not a directory. 
\item
method \texttt{Runtime.exec(String, String[], File)} fails % chktex 36
throwing an \texttt{IOException}. 
\item
an error inside systemOut parser occurs 
\item
an error inside systemErr parser occurs 
\item
Wrapping an \texttt{InterruptedException} 
on the process to be executed thrown by \texttt{Proces.waitFor()}. % chktex 36
\end{itemize}
%
whereas for EEX01 just a failure code is returned. 
\end{minipage}
} \\
\end{longtable}



\begin{longtable}{|ll|}
\toprule
Identifier        & Message  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:TSS} The \texttt{BuildFailureException}s of Settings   }
\endlastfoot%
\texttt{\footnotesize TSS01} 
& \texttt{\footnotesize The tex source directory '\$texSrcDirectoryFile'} \\
& \texttt{\footnotesize should be an existing directory, but is not. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The tex source directory is given in the pom/build-file 
with default value \texttt{./src/site/tex}. 
It contains or is \texttt{\$texSrcProcDirectoryFile}. 
Thus is must be a directory. 
\end{minipage}
} \\
\texttt{\footnotesize TSS02} 
& \texttt{\footnotesize The tex source processing directory '\$texSrcProcDirectoryFile'} \\
& \texttt{\footnotesize should be an existing directory, but is not. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The tex source processing directory is given in the pom/build-file 
relative to \texttt{\$texSrcDirectoryFile}
with default value \texttt{.}. 
It contains all files to be processed. 
Thus is must be a directory. 
\end{minipage}
} \\
\texttt{\footnotesize TSS03}  & \texttt{\footnotesize The output directory '\$outputDirectory'} \\
& \texttt{\footnotesize should be a directory if it exists, but is not. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The output directory is given in the pom/build-file 
with default value \texttt{./target/site/.}. 
The output directory is where the result of the goal/task 
are copied to. 
If it does not yet exist, it is created 
but if it exists and is a regular file, it cannot be created any more. 
\end{minipage}
} \\
\texttt{\footnotesize TSS04}  & \texttt{\footnotesize The target set '\$targets' } \\
& \texttt{\footnotesize should be a subset of the registered targets '...', but is not. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The target set is given in the pom/build-file 
with default value \texttt{pdf, html}. 
A single target can be given on the command line
as e.g.~via \texttt{mvn latex:pdf} and also in this case,
the validity of the target is checked, so that e.g.~\texttt{mvn latex:invalid}
throws an exception, but the mechanism relies directly on mavens ability
to check the targets of this plugin. 
\end{minipage}
} \\
\texttt{\footnotesize TSS05}  & \texttt{\footnotesize The excluded converters '\$convertersExcluded' } \\
& \texttt{\footnotesize should form a subset of the registered converters '...'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
From the possible ``registered'' converters the ones not used may be excluded
to avoid that they cause errors when trying to check correctness of version in
target \texttt{vrs} accessed via \texttt{mvn latex:vrs}.
These converters may not even be installed. 
\end{minipage}
} \\
\texttt{\footnotesize TSS06}  & \texttt{\footnotesize Tried to use converter '\$convStr' } \\
& \texttt{\footnotesize although not among the registered converters '...' as expected. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Only registered converters may be used. 
\end{minipage}
} \\
\texttt{\footnotesize TSS07}  & \texttt{\footnotesize Tried to use converter '\$convStr' } \\
& \texttt{\footnotesize although among the excluded converters '...'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Among the registered converters only those may be used,
which are not excluded, i.e. listed in configuration in section \texttt{convertersExcluded}.
\end{minipage}
} \\
\texttt{\footnotesize TSS08}  & \texttt{\footnotesize Tried to use converter '\$convStr' } \\
 & \texttt{\footnotesize in configuration '...' instead of configuration '...'. } \\
 \multicolumn2{|l|}{
 \begin{minipage}{0.95\linewidth}
   Each converter may occur in a specified configuration only.
   So e.g. \texttt{pdflatex} is only allowed in configuration
   '\texttt{latex2pdfCommand}'.
   If used in configuration '\texttt{makeIndexCommand}' this causes this exception,
   because in that configuration, e.g \texttt{makeindex} is allowed. 
 \end{minipage}
 } \\
\end{longtable}




\begin{longtable}{|ll|}
\toprule
Id.        & Message  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:TMI} The \texttt{BuildFailureException}s of MetaInfo  }
\endlastfoot%
\texttt{\footnotesize TMI01} 
& \texttt{\footnotesize Cannot get stream to file '\$fileName'. }  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
  Stream to file within jar.
  This may be the manifest file, pom.properties or git.properties. 
\end{minipage}
} \\
\texttt{\footnotesize TMI02} 
& \texttt{\footnotesize Cannot load properties from file '\$fileName'.  }  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
  Provided the stream to the file is ok,
  could not load property.
  This may occur for pom.properties or git.properties. 
\end{minipage}
} \\
\texttt{\footnotesize TMI03} 
& \texttt
{\footnotesize IOException reading manifest. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Provided the stream to the manifest file is ok, could not read completely.
\end{minipage}
} \\
\end{longtable}

\begin{longtable}{|ll|}
\toprule
Id.        & Message  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:TFU} The BuildFailureExceptions of TexFileUtilsImpl  }
\endlastfoot%
\texttt{\footnotesize TFU01} 
& \texttt{\footnotesize Cannot create destination directory '\$targetDir'. }  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
This is mainly because of writing permissions. 
\end{minipage}
} \\
\texttt{\footnotesize TFU04} 
& \texttt{\footnotesize Cannot overwrite directory '\$destFile'. }  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Because this plugin shall not turn directories into regular files 
and vice versa. 
This failure indicates that another plugin/task disturbs this one. 
\end{minipage}
} \\
\texttt{\footnotesize TFU06} 
& \texttt
{\footnotesize Cannot copy file '\$srcFileName' to directory '\$targetDir'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
This is mainly because of writing permissions. 
\end{minipage}
} \\
\end{longtable}





FIXME\@: to be added. 


\section{Logging of Warnings and Errors}\label{sec:logWarnErr}

The rules for logging warnings and errors is, 
that the user must be notified, 
if something went wrong but the run is not aborted, 
by a warning or an error. 
It is not required that for each detail going wrong, 
there is a separate notification, 
but the user must be sure, that all is ok, 
if no warning and no error occurs. 

To decide whether it is an error or a warning to be logged, 
one has to distinguish, 
whether the problem occurs when running an external application 
or within internal code. 
In the first case, the decision whether it is an error or a warning 
is left to that application: 
%
\begin{itemize}
\item 
If the application returns an error code other than 0, 
it is an error. 
\item
If the application is expected to write a log file 
but none is found, it is an error. 
The applications used here, 
return a nontrivial error code if no log file is written. 
\item
The applications used here, writing a log file 
distinguish between error and warning. 
If a log file is written both are logged in the log file 
and can be distinguished by the form of the entry via pattern matching. 
If no error occurs, the return code is 0, even if warnings occur. 
\item
If an application writes at least one error into the log file, 
this software logs an error. 
\item
If an application writes no error into the log file 
but at least one warning, principally this software logs a warning. 
There may be parameters to switch off warnings partially 
or all of them, 
but there must be also a configuration of parameter values 
that allow logging all warnings. 
\end{itemize}

If an application does not create the expected output file, 
this software logs an error. 
This may be because of an internal error as described above, 
but also because of wrong parameters. 
So, e.g.~\texttt{pdflatex -v xxx.tex} does not create a pdf-file as expected. 


\begin{longtable}{|ll|}
\toprule
\small Id.        & \small Message  \\
\multicolumn2{|l|}{\small Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:WarnALP} The errors and warnings on running a command  }
\endlastfoot%
\texttt{\footnotesize EEX01} & \texttt{\footnotesize Running \$command 
			    failed with return code \$returnCode. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Compare with TEX01 in Table~\ref{tab:TEX}: 
Error execution means that there is even no valid return code. 
% Variables: 
% %
% \begin{itemize}
% \item \texttt{\$command}: The command executed. 
% \item \texttt{\$returnCode}: The failure code which is not $0$ in this case. 
% \end{itemize}
\end{minipage}
} \\
\texttt{\footnotesize EEX02} & \texttt{\footnotesize Running \$command failed: 
			  No target file '\$fileName' written. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize EEX03} 
& \texttt{\footnotesize Running \$command failed: 
Target file '\$fileName' is not updated. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The command \texttt{\$command} is expected 
to write to the file '\texttt{\$fileName}' but this file is not updated. 
This indicates an error executing \texttt{\$command}. 
\end{minipage}
} \\
\texttt{\footnotesize WEX04} 
& \texttt
{\footnotesize Cannot read target file '\$fileName'; may be outdated. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize WEX05} 
& \texttt{\footnotesize Update control may emit false warnings. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize EAP02} & \texttt{\footnotesize Running \$command failed: 
No log file '\$logFileName' written. }  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The command \texttt{\$command} is expected 
to write a log file '\texttt{\$logFileName}' but no such file exists. 
This indicates an error executing \texttt{\$command}. 
\end{minipage}
} \\
\texttt{\footnotesize EAP01}  & \texttt{\footnotesize Running \$command failed. 
Errors logged in '\$logFileName'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The command \texttt{\$command} logged at least one error 
in the file '\texttt{\$logFileName}', 
where more details can be found. 
\end{minipage}
} \\
\texttt{\footnotesize WAP03} 
& \texttt{\footnotesize Running \$command emitted warnings 
logged in '\$logFileName'. }  \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
The command \texttt{\$command} logged at least one warning 
in the file '\texttt{\$logFileName}', 
where more details can be found. 
Note that if \texttt{\$command} is a latex processor, 
this warning comes only iff the parameter \texttt{\$debugWarnings} is set. 
Note also that notifications on bad boxes are not counted as warnings here. 
\end{minipage}
} \\
\texttt{\footnotesize WLP03} 
& \texttt{\footnotesize Running \$command created bad boxes 
logged in '\$logFileName'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Here, \texttt{\$command} is a latex processor. 
It logged at least one bad box, 
overfull or underfull, horizontal or vertical 
in \texttt{\$logFileName} where more details can be found. 
Note that 
this warning comes only iff the parameter \texttt{\$debugBadBoxes} is set. 
\end{minipage}
} \\
\texttt{\footnotesize WLP06} 
& \texttt{\footnotesize Running \$command 
found issues logged in '\$logFileName'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
Here, \texttt{\$command} is a checker tool. 
Strictly speaking, unlike the other warnings here, 
this does not signify that running \texttt{\$command} went wrong 
but uncovered an issue (warning/error/message) logged in a file. 
\end{minipage}
} \\
\texttt{\footnotesize WLP05} 
& \texttt{\footnotesize Use package 'splitidx' 
without option 'split' in '\$texFileName'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
This indicates that an extended idx-file ``\texttt{xxx-yy.idx}'' 
has been found without \texttt{xxx.idx} or without according entry 
\texttt{\textbackslash indexentry[yy]\{\dots\}\{\dots\}} 
in \texttt{xxx.idx}. 
\end{minipage}
} \\
\end{longtable}


\begin{longtable}{|ll|}
\toprule
Id.        & Message  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:WarnCEI} The errors and warnings on files/streams  }
\endlastfoot%
\texttt{\footnotesize WFU01} 
& \texttt{\footnotesize Cannot read directory '\$dir'; 
build may be incomplete. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize WPP02} 
& \texttt{\footnotesize Cannot read tex file '\$texFile'; 
may bear latex main file. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize WAP04} 
& \texttt{\footnotesize Cannot read log file '\$logFileName'; 
  may hide warnings/errors. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize WLP02} 
& \texttt{\footnotesize Cannot read log file '\$logFileName'; 
  \$kind may require rerun. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize WLP04} 
& \texttt{\footnotesize Cannot read idx file '\$idxFileName'; 
skip creation of index. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize WFU03} 
& \texttt{\footnotesize Cannot close '\$closeable'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize EFU05} 
& \texttt{\footnotesize Cannot delete file '\$delFile'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}

\end{minipage}
} \\
\texttt{\footnotesize EFU06} 
& \texttt{\footnotesize Cannot move file '\$fromFile' to '\$toFile'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\end{longtable}


\begin{longtable}{|ll|}
\toprule
Id.        & Message  \\
\multicolumn2{|l|}{Explanation }  \\
\midrule
\midrule
\endfirsthead%
\bottomrule
\caption{\label{tab:WarnLPP} Miscellaneous errors and warnings  }
\endlastfoot%
\texttt{\footnotesize WPP03} 
& \texttt{\footnotesize Skipped processing of files with suffixes \$skipped. }\\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize WPP04} 
& \texttt{\footnotesize Skip processing '\$srcFile': 
  interpreted as target of '\$lmFile'. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\texttt{\footnotesize WLP01} 
& \texttt{\footnotesize LaTeX requires rerun 
but maximum number \$maxNumRerunsLatex reached. } \\
\multicolumn2{|l|}{
\begin{minipage}{0.95\linewidth}
FIXME
\end{minipage}
} \\
\end{longtable}








%\begin{longtable}
  
%\end{longtable}

FIXME\@: to be added. 

\chapter{Listings}\label{chap:listings}% maybe appendix?


First we list the versions of the executables
which are run to create this manual.
They are given in \url{../../main/resources/version.properties}

\lstinputlisting[language=xml, basicstyle=\scriptsize,
%irstline=220, lastline=1108,
breaklines,
%float,
captionpos=b, label={lst:versionsExec},
caption={The versions of the executables potentially used}]
{../../main/resources/version.properties}% chktex 11 


Next we provide listings of the configuration 
in the \texttt{pom.xml} for the maven-plugin 
and in the \texttt{build.xml} for the ant-task. 
The listing of the \texttt{build.xml} shows 
which parameters are attributes and which ones are text elements. 
In \texttt{pom.xml} only text elements occur. 


The maven-plugin described here, 
requires the definition in \texttt{pom.xml}
given by Listing~\ref{lst:fullConfig}. 

%\lstset{language=xml, basicstyle=\scriptsize}
% FIXME\@: nag complains for htlatex 
\lstinputlisting[language=xml, basicstyle=\scriptsize,
firstline=569, lastline=1505,
breaklines, showstringspaces=false,
%float,
captionpos=b, label={lst:fullConfig},
caption={The full configuration of this maven plugin}]
{../../../pom.xml}% chktex 11 

It has to be placed in the build element where below dots are given. 

\begin{lstlisting}[language=xml]
  <build>
    <plugins>
      ...
    </plugins>
  </build>
\end{lstlisting}


The ant-task described here 
requires the target and task definitions in \texttt{build.xml}
given by Listing~\ref{lst:fullConfigAnt}. 

%\lstset{language=xml, basicstyle=\scriptsize}
% FIXME\@: nag complains for htlatex 
\lstinputlisting[language=xml, basicstyle=\scriptsize,
firstline=74, lastline=238,
breaklines,
%float,
captionpos=b, label={lst:fullConfigAnt},
caption={The definition of this ant task and target}]
{../../../build.xml}% chktex 11 



\chapter{Gaps}\label{chap:gaps}

Only figures created with xfig and stored as files pdf and ptx 
may be integrated into a \LaTeX{} document. 
This could be extended to a broader variety of export file formats. 
The problem is, that fig-files to not contain information on the export
format. 
This has to be either given elsewhere in a config file 
or determined by pre-parsing the tex-files. 

There is no support for pictures in \gls{gif}-format 
but maybe a converter to \gls{png} is all needed. 

There is no proper make-mechanism taking dependencies into account. 
Thus all documents in all formats specified are remade, 
whether they changed or not. 

Also, if more than one target is created from one \LaTeX{} source, 
common steps are redone for each target. 
E.g.~if pdf and html are created, 
pdf creation is done twice and if pdf, html, odt and docx are created, 
odt is done twice (once for odt second for docx) 
and pdf is done even trice: 
once for pdf itself, once for odt and once for docx. 

% This has to be removed. 
Creating more than one index is supported only 
via package \pkg{splitidx} in conjunction with \texttt{SplitIndex}. 
There are the following packages also supporting multiple indices 
but not supported officially: 
\pkg{index} described in~\cite{IndexP}, 
\pkg{amsmidx} described in~\cite{AmsmidxP} and 
\pkg{imakeidx} described in~\cite{ImakeidxP}.
Note that the package \pkg{multind} is obsolete. 

According to~\cite{GloP}, Section~1, 
there are three options to create a glossary, 
whereas this software supports option two only, 
which uses \texttt{makeindex}. 
Also, although the package \pkg{glossaries} itself 
supports multiple glossaries via the command
%
\begin{lstlisting}[language=TeX, basicstyle=\small]
\newglossary[log-ext]{name}{in-ext}{out-ext}{title}[counter]
\end{lstlisting}
%
described in~\cite{GloP}, Section~12, 
this software only supports creating a single glossary. 

Reading~\cite{GloP}, Section~15.1, the glossarystyle \texttt{index} 
seems to allow creating indices through the \pkg{glossaries} package 
making any index-package obsolete. 

For development given the \LaTeX{} main file \texttt{xxx.tex}, 
the files \texttt{xxx.pdf}, \texttt{xxx.pdf}, \texttt{xxx.synctex.gz} 
and \texttt{xxx.log} are vital. 
Thus it would be fine to have a goal which touches these files 
or to have a parameter to touch these prior to creation 
to avoid that these are cleaned up after the run. 
This is an alternative to setting parameter \texttt{cleanup} to \texttt{false}. 
On the other hand, goal \texttt{grp} creating graphics 
in conjunction with a development tool like \texttt{auctex} for \texttt{emacs}, 
allows to compile a latex main file in that tool 
and thus to access \texttt{xxx.log} and \texttt{xxx.pdf}. 

There are lots of possible improvements to be done on the goal {\em check}. 


The ant-task does not allow to create single formats, e.g.~pdf selectively. 

The ant-build is not completed: tests are not run and 
test runs are no prerequisite for installation. 

This manual is not finished. 
To test the overall functionality of the maven-plugin and of the ant-task 
described here, this manual is created through plugin and task. 

Support for djvu via pdf2djvu: 
pdf2djvu -o output\_file input\_file

pdf2dsc
(ps with document structuring convention) 

pdf2svg is not so useful. 

pdftohtml -c is also not bad, 

consider also pdftocairo for creation of tiff and ps and many others. 

\chapter{Bugs}\label{chap:bugs}

Seemingly, indices and glossaries based on page numbers 
(there seems to be an alternative to this), 
may be out of date with the current algorithm: 
First \texttt{pdflatex} is run to create the raw index. 
Then a sorting program like \texttt{makeindex} is called 
which creates the sorted, collected and formatted index. 
Then one \texttt{pdflatex} run is required to include this index 
into the created pdf-file. 
A second \texttt{pdflatex} run is required 
to write the index to the table of contents, as typically required. 
The problem with this procedure is, 
that the subsequent runs of \texttt{pdflatex} change the raw index 
which requires rerunning \texttt{makeindex} 
and after that again \texttt{pdflatex}. 

One way to solve that problem is to use the package \pkg{imakeidx} 
(improved makeidx) instead of the traditional package \pkg{makeidx}. 
This offers also multiple indices, which is another gap to be filled. 
Seemingly, \pkg{imakeidx} does not support glossaries 
and so for these, another solution is required, 
although the problem is the same. 

Packages \pkg{robustindex} and \pkg{robustglossaries} 
% **** reference? 
offer another solution. 
The advantage would be to have handled both index and glossary. 
Also support of hyperrefs within indices and glossaries seem to be expanded. 
On the other hand, the two packages seem experimental 
and seem to to play with package \pkg{hyperref}. 

The current implementation is based on package \pkg{rerunfilecheck} 
which works for index but not for glossary. 

Check whether \pkg{glossaries} option \texttt{autorun} makes sense. 
Seems to run the command \texttt{makeglossaries} after each latex run. 
But how to find out whether to rerun latex??? 

Pattern to identify latex main file: 
Documentation: shall not include the environment 
\texttt{documentclass/documentstyle} in an input. 
Also check \texttt{RequiresPackage} 
and check whether \texttt{(re)newcommand} is possible % chktex 36
or makes sense. 

Maybe there is a bug in the number of reruns: 
I think, makeglossaries is like bibtex needing two latex reruns 
and not like makeindex, which requires a single rerun. 

Since this software heavily relies on \pkg{rerunfilecheck}, 
maybe a warning if not used is a good idea. 

Figures are missing in html output 
Formulae are missing in html output. 
Index is s missing in html output. 
Glossary occurs in the toc but is not numbered. 

Did not find a way to add a numbered entry for the glossary 
into the table of contents. 

The pattern \texttt{(!\ )} detects an error only % chktex 37
\texttt{-no-file-line-error} (which is the default) is set 
but does not work with option \texttt{-file-line-error}. 
This yields 
%
\begin{verbatim}
./manualLatexMavenPlugin.tex:2500: Undefined control sequence.
l.2500 \bla
\end{verbatim}
%
instead of 
%
\begin{verbatim}
! Undefined control sequence.
l.2500 \bla
\end{verbatim}

I ask myself how to detect this error in file line error mode! 

%\bla

Pattern matching is line-wise. 
This is inappropriate for patternLatexMainFile 
but also for further patterns like multiline-warnings. 

Also there seems to be a bug in java's regex package, 
which leads to non-termination: 
pattern \texttt{\~(\textbackslash s*)*xx} seems not to terminate. % chktex 1

A problem is also that the ending ``\texttt{.svg}'' may occur as a source 
and as a target file of htlatex. 
Thus \texttt{mvn latex:clr} tries to delete the targets of the svg-files, 
although these are not sources but themselves targets. 

A way to solve this problem is, 
to apply the delete pattern to graphic source files 
and the files created. 
CAUTION\@: for svg, 
the files created by the latex run shall be taken into account. 
A warning shall be issued for each matching. 


Target html: references to figures are missing. 
jpg and png-pictures oddly represented. 
With option svg: problem. 
Leave away, then at least the formula occurs. 
But then, from the mixed pictures only the text occur, 
whereas the pdf is still missing. 
Maybe htlatex still relies on eps-format. 
Table is very wide. 
Umlauts and sz maybe also not properly represented. 

Still for target html: currently all aspects making problems 
are deactivated: 
Figures, index and glossary. 
For the index have a look at the log-file. 
These aspects must be re-integrated as soon as possible. 

For html: run package tex4ht with option \texttt{info} 
to obtain further options and their descriptions. 
Also add a proper description into this manual. 

For files \texttt{.directory} (``\texttt{.}'' first), 
the separation of root and suffix does not work. 
Maybe the best to ignore files like that. 

Target \texttt{txt}: seems as if index and glossary not up to date. 

target \texttt{pdf}: Idea to run \texttt{makeglossaries} 
always prior to pdflatex. 

Maybe this is more a gap than a bug: 
support for dvi-creation should be provided separately. 

For target dvi, 
neither png nor jpg-pictures are included. 
The other formats work with \texttt{\$pdfViaDvi} set. 
Note that the postscript-files must be in the same directory 
as the dvi, probably because it includes them 
only by link. 

For the other case, \texttt{\$pdfViaDvi} unset, this requires some research. 

Also for creation of the txt-format, 
\texttt{\$pdfViaDvi} must be set. 

FIXME\@: on bibliography, index and glossary 

The application \texttt{chktex} does not necessarily return an error code 
if something goes wrong, e.g.~reading \texttt{-l chktexrc}. 
Thus only in debug mode one can recognize the misbehavior. 
This knocks out detection of build failures. 

Also I would like to replace the global \texttt{chktexrc} by a local version, 
via `\texttt{-g0 -l chktexrc.my}'. 
The problem is, 
that the file is interpreted relative to the working directory. 

The application chtex has an option \texttt{-I} to specify, 
whether input files shall be read. 
If not, creation of graphics is immaterial. 
I can also imagine, that one wants to configure, 
whether graphics shall be created or not. 

It may make sense to define in \texttt{chktexrc} another verbosity level 
with format allowing to decide whether there is a warning/error/message. 
Now I modified the levels that all but the headlines start with blank. 
This makes it easy in -v1 and in -v2 to detect warning/error/message 
at the beginning of a line, 
without the risk of false error because a message is logged 
on a text starting with the word ``error''. 


Maybe this is not a bug 
but an inconsistency between auctex and local config: 
Running with the plugin, we obtain 
%
\begin{Verbatim}[fontsize=\tiny]
This is pdfTeX, Version 3.14159265-2.6-1.40.15 (TeX Live 2014) (preloaded format=pdflatex 2014.8.9)  30 JAN 2017 10:58
entering extended mode
 \write18 enabled.
 Source specials enabled.
 %&-line parsing enabled.
**test.tex
(./test.tex
\end{Verbatim}
%
whereas running from within Emacs with auctex we obtain 
%
\begin{Verbatim}[fontsize=\tiny]
This is pdfTeX, Version 3.14159265-2.6-1.40.15 (TeX Live 2014) (preloaded format=pdflatex)
 restricted \write18 enabled.
entering extended mode
\end{Verbatim}
%
and also the behavior is slightly different, 
e.g. on file 
% TBD: clarify why this does not work with lstlisting...
\begin{verbatim}
\documentclass{article}
\begin{document}
 
\end{document}
\end{verbatim}

The parameter \texttt{patternReRunLatex} 
treated in Section~\ref{subsec:patternReRunLatex} 
needs more careful investigation. 
This is done a little bit in class \texttt{org.m2latex.core.Settings}.  


\chapter{Tests}\label{chap:tests}

FIXME\@: this chapter describes the tests to be performed. 

Missing are tests on logging, tests on various input formats, 
output formats, tests including several paths 
defined by invocation of auxiliary applications for index, glossary, \dots 

\bibliographystyle{alpha}
\bibliography{lit}{}

\ifthenelse{\boolean{texFhtLoaded}}{
  % no index and no glossaries with tex4ht 
}{
%\chapter{Indices}
  \printindex[idx]
  \printindex[pkg]
  \printglossaries%
}


%  "-src-specials -shell-escape -recorder" 
\end{document}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "manualLatexMavenPlugin"
%%% End:
